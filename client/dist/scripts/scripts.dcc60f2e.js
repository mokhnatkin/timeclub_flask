"use strict";angular.module("timeclubAngularApp",["ngResource","ui.router","ui.bootstrap","ui.bootstrap.datetimepicker","ui.mask","LocalStorageModule","angularChart","angularUtils.directives.dirPagination"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){a.state("app",{url:"/",views:{header:{templateUrl:"views/header.html",controller:"HeaderCtrl"},content:{templateUrl:"views/main.html",controller:"MainCtrl"},footer:{templateUrl:"views/footer.html"}}}).state("app.reservations",{url:"reservations",views:{"content@":{templateUrl:"views/reservations.html",controller:"ReservationCtrl"}}}).state("app.dashboard",{url:"dashboard",views:{"content@":{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}}}).state("app.history",{url:"history",views:{"content@":{templateUrl:"views/history.html",controller:"HistoryCtrl"}}}).state("app.stat",{url:"stat",views:{"content@":{templateUrl:"views/stat.html",controller:"StatCtrl"}}}).state("app.clients",{url:"clients",views:{"content@":{templateUrl:"views/clients.html",controller:"ClientsCtrl"}}}).state("app.preferences",{url:"preferences",views:{"content@":{templateUrl:"views/preferences.html",controller:"PreferencesCtrl"}}}).state("app.login",{url:"login",views:{"header@":{templateUrl:"views/header-login.html"},"content@":{templateUrl:"views/login.html",controller:"LoginCtrl"}}}).state("Modal",{views:{modal:{templateUrl:"views/modal.html",controller:"MainCtrl"}},"abstract":!0}).state("Modal.confirmClose",{views:{modal:{templateUrl:"views/confirm.html",controller:"CheckoutCtrl"}}}).state("app.emplwages",{url:"emplwages",views:{"content@":{templateUrl:"views/emplwages.html",controller:"EmplWagesCtrl"}}}).state("Modal.checkoutDetails",{views:{modal:{templateUrl:"views/checkoutdetails.html",controller:"CheckoutDetailsCtrl"}},onEnter:["$state",function(a){$(document).on("keyup",function(b){27==b.keyCode&&($(document).off("keyup"),a.go("app"))}),$(document).on("click",".Modal-backdrop, .Modal-holder",function(){a.go("app")}),$(document).on("click",".Modal-box, .Modal-box *",function(a){a.stopPropagation()})}]}),b.otherwise("/"),c.setPrefix("timeclubAngularApp").setStorageType("localStorage")}]).run(["$rootScope","$location","localStorageService","textConsts",function(a,b,c,d){a.adminRoleName=d.getAdminRoleName(),a.oneDayInMSec=d.getOneDayInMSec(),c.isSupported&&(a.currentUserId=c.get("currentUserId"),a.currentUserName=c.get("currentUserName"),a.currentUserRole=c.get("currentUserRole"),a.isAdmin=c.get("isAdmin"),a.isAuthenticated=c.get("isAuthenticated")),a.$on("$stateChangeStart",function(a,b,c,d,e){$("#ui-view").html(""),$(".page-loading").removeClass("hidden")}),a.$on("$stateChangeSuccess",function(a,b,c,d,e){$(".page-loading").addClass("hidden")}),a.$on("$locationChangeStart",function(c,d,e){var f=-1===$.inArray(b.path(),["/login","/register"]);f&&!a.isAuthenticated&&(console.log("Not Authenticated"),b.path("/login")),a.isAuthenticated&&b.path("/")})}]).filter("phoneFilter",function(){return function(a){var b="";return b="+7("+a.slice(0,3)+")"+a.slice(3,6)+" "+a.slice(6,8)+" "+a.slice(8,10)}}),angular.module("timeclubAngularApp").controller("MainCtrl",["$scope","guestFactory","guestCompute","clientFactory","activePromotionFactory","$state","promoDetails","rowColorsGuests","checkoutService","msgService","convertMMtoDDHHMM","guestFilterFactory","emplFactory","textConsts","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.showGuests=!1,a.message=j.getMsg("loadingInProgress");var p,q;a.showAddGuestModal=!0,a.showAddGroupTable=!1,a.showChangeButton=!0,a.showCloseButton=!0,a.showAddGroupModule=!0,a.newGuests=[];var r=n.getConstValueByName("companiesMaxNum");a.companies=[];for(var s=0;r>s;s++)a.companies[s]=s+1;var t,u,v;a.promotions=[],e.getItems().then(function(d){a.promotions=d.data,q=a.promotions.length,b.getItems().then(function(b){a.guests=b.data,p=a.guests.length,o.getItem().then(function(b){u=b.data,v=new Date(u.currentDateTime),a.currentTimeToShow=v,a.guests=c.modifyGuestArr(a.guests,a.promotions,v),a.outStatNow=c.computeGuestStat(a.guests),a.showGuests=!0},function(b){v=new Date,a.currentTimeToShow=v,a.guests=c.modifyGuestArr(a.guests,a.promotions,v),a.outStatNow=c.computeGuestStat(a.guests),a.showGuests=!0,console.log("serverTimeFactory: "+j.getMsg("cannotQueryData"))})},function(b){a.message=j.getMsg("cannotQueryData")+d.status+" "+d.statusText})},function(a){console.log("activePromotionFactory: "+j.getMsg("cannotQueryData"))}),a.employees=[],m.getItems().then(function(b){a.employees=b.data},function(b){a.message=j.getMsg("cannotQueryData")+response.status+" "+response.statusText,window.alert("emplFactory: "+j.getMsg("cannotQueryData"))}),a.getPromoNameById=function(b){var c;return c=g.getNameById(b,a.promotions)},a.setRowBackgroud=function(a,b,c){var d;return d=h.setRowColor(a,b,c)},a.removePromoIfFree=function(a,b){var c;return c=a?null:b},a.disableIsFreeAD=[],a.disablePromoSelectAD=[],a.disableIsFreeED=!1,a.disablePromoSelectED=!0,a.changeIsFreeFlagByPromo=function(b,d,e){var f=!1,g=c.isSelectedPromoBirthday(b,a.promotions);return g?("AD"==d?(a.disableIsFreeAD[e]=!0,a.disablePromoSelectAD[e]=!1):"ED"==d&&(a.disableIsFreeED=!0,a.disablePromoSelectED=!1),f=!0):("AD"==d?(a.disableIsFreeAD[e]=!1,a.disablePromoSelectAD[e]=!0):"ED"==d&&(a.disableIsFreeED=!1,a.disablePromoSelectED=!0),f=!1),f},a.changeDefCompanyN=function(a){t=a},a.addOneGuestToGroup=function(){var b=a.newGuests.length;a.newGuests.push({}),a.newGuests[b].guestIndex=b,a.newGuests[b].companyN=t,a.disableIsFreeAD.push(!1),a.disablePromoSelectAD.push(!0)},a.fillGroupInfo=function(){a.addOneGuestToGroup(),a.showAddGroupTable=!0,a.showAddGuestModal=!1,a.showChangeButton=!1,a.showCloseButton=!1},a.cancelFillGroupInfo=function(){a.showAddGroupTable=!a.showAddGroupTable,a.showAddGuestModal=!a.showAddGuestModal,a.showChangeButton=!a.showChangeButton,a.showCloseButton=!a.showCloseButton,a.newGuests=[],a.disableIsFreeAD=[],a.disablePromoSelectAD=[],t=""},a.removeOneGuestFromGroup=function(b){if(a.newGuests.length>1){a.disableIsFreeAD.splice(b,1),a.disablePromoSelectAD.splice(b,1),a.newGuests.splice(b,1);for(var c=0;c<a.newGuests.length;c++)a.newGuests[c].guestIndex=c}else window.alert(j.getMsg("doNotRemoveFrstRow"))},a.addGuest=function(b){b=c.actualizateGuest(b,a.promotions),d.createItem(b).then(function(c){a.showAddGuestModel=!a.showAddGuestModel,b={},f.reload()},function(b){a.status="Unable to create item: "+b.message,console.log(a.status)})},a.putGroupIntoDB=function(){for(var b=!0,c=a.newGuests.length,d=0;c>d;d++)b=void 0!=a.newGuests[d].name?b&&!0:b&&!1;if(b)for(d=0;c>d;d++)a.addGuest(a.newGuests[d]);else window.alert(j.getMsg("needNamesForAllGuests"))},a.guestsToCheckout=[],a.showCheckoutModal=function(){for(var b,c,d=!1,e=0;p>e;e++)d=d||a.guests[e].isChecked,a.guests[e].isChecked&&a.guestsToCheckout.push(a.guests[e]);d?o.getItem().then(function(d){c=d.data,b=c.currentDateTime,i.saveArr(a.guestsToCheckout,b),f.go("Modal.confirmClose")},function(c){b=new Date,console.log("serverTimeFactory: "+j.getMsg("cannotQueryData")),i.saveArr(a.guestsToCheckout,b),f.go("Modal.confirmClose")}):window.alert(j.getMsg("selectGuestToClose"))},a.guestToEdit={},a.showEditGuestModal=!1,a.cancelAddingGuest=function(){a.newGuest={}},a.editGuests=function(){for(var b=!1,d=0,e=0;p>e;e++)b=b||a.guests[e].isChecked,a.guests[e].isChecked&&(d++,a.guestToEdit=a.guests[e]);var f;if(b)if(1==d){a.showCloseButton=!1,a.showAddGroupModule=!1,a.showChangeButton=!1,a.showAddGuestModal=!1,f=c.isSelectedPromoBirthday(a.guestToEdit.promotion,a.promotions),f?(a.disablePromoSelectED=!1,a.disableIsFreeED=!0):(a.disablePromoSelectED=!0,a.disableIsFreeED=!1),a.showEditGuestModal=!0;for(var g=0;p>g;g++)a.guests[g].isChecked=!1}else window.alert(j.getMsg("selectJustOneRow"));else window.alert(j.getMsg("selectTheRowToChange"))},a.postChangesToGuest=function(){a.guestToEdit=c.actualizateGuest(a.guestToEdit,a.promotions),d.updateItem(a.guestToEdit).then(function(b){a.showAddGuestModal=!0,a.showAddGroupModule=!0,a.showCloseButton=!0,a.showChangeButton=!0,f.reload()},function(a){console.log("Item cannot be updated:"+a.message)})},a.cancelEditingGuest=function(){a.guestToEdit={},a.showEditGuestModal=!1,a.showAddGuestModal=!0,a.showChangeButton=!0,f.reload()},a.convertMinutes=function(a){var b=k.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=l.searchGuestNameAndCompany(b,a.search)},a.computeSearchTotals=function(b){var c=[];return b.length>0&&(c=l.computeSearchTotals(b,a.guests)),c},a.changeEmplIsDir=function(b){return c.changeEmplIsDir(b,a.employees)},a.changeEmplName=function(b){return c.changeEmplName(b,a.employees)}}]),angular.module("timeclubAngularApp").controller("LoginCtrl",["$scope","$state","AuthFactory","$location","$rootScope","staffFactory","localStorageService","msgService","$window",function(a,b,c,d,e,f,g,h,i){a.login=function(){c.login(this.username,this.password).then(function(a){var b=a.data,c=b.token,f=b.current_user;console.log("token from server",c),console.log("current_user",f),e.currentUserId=f.id,e.currentUserName=f.username,e.currentUserRole=f.role,e.isAdmin=f.isAdmin,e.isAuthenticated=!0,g.clearAll(),g.isSupported&&(g.set("token",c),g.set("currentUserId",f.id),g.set("currentUserName",f.username),g.set("currentUserRole",f.role),g.set("isAdmin",f.isAdmin),g.set("isAuthenticated",!0),console.log("token saved to localStorage",c)),i.location.reload(),d.path("/")},function(a){window.alert(h.getMsg("cannotLogin"))})},a.cancelLogin=function(){a.username="",a.password=""}}]),angular.module("timeclubAngularApp").controller("ReservationCtrl",["$scope","bookingFactory","$state","rowColorsBookings","$rootScope","clientListFactory","bookingFactoryToday","bookingFactoryLastYear","bookingFactoryTodayAndFuture","msgService","textConsts","guestCompute","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.showInfo=!1,a.showAddBookingForm=!0,a.showSearchForm=!0,a.showEditBookingForm=!1,a.phoneMask=k.getPhoneMask(),a.statuses=k.getBookingStatuses();var n;a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0,a.showTodayBookings=function(){g.getItems().then(function(b){a.bookings=b.data,n=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!1,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0},function(b){a.message=j.getMsg("cannotQueryData")+response.status+" "+response.statusText})},a.showTodayBookings(),a.showTodayAndFutureBookings=function(){i.getItems().then(function(b){a.bookings=b.data,n=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!1,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!0},function(b){a.message=j.getMsg("cannotQueryData")+response.status+" "+response.statusText})},a.showAllBookings=function(){b.getItems().then(function(b){a.bookings=b.data,n=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!1,a.PastYearBookingsBtn=!0},function(b){a.message=j.getMsg("cannotQueryData")+response.status+" "+response.statusText})},a.showPastYearBookings=function(){h.getItems().then(function(b){a.bookings=b.data,n=a.bookings.length,a.showInfo=!0,a.search="",a.TodayBookingsBtn=!0,a.TodayAndFutureBookingsBtn=!0,a.AllBookingsBtn=!0,a.PastYearBookingsBtn=!1},function(b){a.message=j.getMsg("cannotQueryData")+response.status+" "+response.statusText})},a.setRowBackgroud=function(b){var c;return c=d.setRowColor(b,a.statuses)},a.newBooking={},a.addBooking=function(b){var c,d;null==b.date||void 0==b.date?window.alert(j.getMsg("needDateTimeBooking")):m.getItem().then(function(e){c=e.data,d=new Date(c.currentDateTime),b.date>d?a.postBookingToDB(b,d):window.alert(j.getMsg("noBookingInPast"))},function(c){d=new Date,console.log("serverTimeFactory: "+j.getMsg("cannotQueryData")),b.date>d?a.postBookingToDB(b,d):window.alert(j.getMsg("noBookingInPast"))})},a.postBookingToDB=function(d,g){d.status=a.statuses[0],b.createItem(d).then(function(b){a.showAddGuestModel=!a.showAddGuestModel;var h=!0;f.findItemByPhone(d.phone).then(function(a){var b=a.data;if(1==b.result&&(h=!1),h){var c={};c.phone=d.phone,c.name=d.name,c.sysComment="клиент создан при создании брони  "+g+" пользователем "+e.currentUserName,f.createItem(c).then(function(a){console.log("Клиент из брони: "+j.getMsg("recordCreated")),c={}},function(a){console.log(j.getMsg("cannotSaveRecord"))})}},function(b){a.status="Unable to use find by phone service: "+b.message,console.log(a.status)}),a.newBooking={},c.reload()},function(b){a.status="Unable to create item: "+b.message,console.log(a.status)})},a.cancelAddingBooking=function(){a.newBooking={}},a.checkBookingStatusBeforeUpdate=function(b,c){var d=!0;return b==c?d=!1:(b!=a.statuses[1]||c!=a.statuses[2]&&c!=a.statuses[3]||(d=!1),b==a.statuses[2]&&c==a.statuses[3]&&(d=!1),b==a.statuses[3]&&c==a.statuses[2]&&(d=!1)),d},a.showModifyBookingForm=function(){for(var b,c=!1,d=0,e=0;n>e;e++)c=c||a.bookings[e].isSelected,a.bookings[e].isSelected&&(d++,a.modifiedBooking=a.bookings[e],b=e);c?1==d?a.bookings[b].status==a.statuses[0]?(a.showEditBookingForm=!0,a.showAddBookingForm=!1,a.showSearchForm=!1,a.bookings[b].isSelected=!1):window.alert(j.getMsg("cannotUpdateThisBooking")):window.alert(j.getMsg("selectJustOneRow")):window.alert(j.getMsg("selectTheRowToChange"))},a.postChangesToBooking=function(b){var c,d;null==b.date||void 0==b.date?window.alert(j.getMsg("needDateTimeBooking")):m.getItem().then(function(e){c=e.data,d=new Date(c.currentDateTime),b.date>d?a.postChangesOfBookingToDB(b):window.alert(j.getMsg("noBookingInPast"))},function(c){d=new Date,console.log("serverTimeFactory: "+j.getMsg("cannotQueryData")),b.date>d?a.postChangesOfBookingToDB(b):window.alert(j.getMsg("noBookingInPast"))})},a.postChangesOfBookingToDB=function(d){b.updateItem(a.modifiedBooking).then(function(a){c.reload()},function(a){console.log("Item cannot be updated:"+a.message)}),a.showEditBookingForm=!1,a.showAddBookingForm=!0,a.showSearchForm=!0},a.cancelEditingBooking=function(b){a.showEditBookingForm=!1,a.showAddBookingForm=!0,a.showSearchForm=!0,a.bookings[bookingSelectedN].isSelected=!0,a.modifiedBooking={},c.reload()},a.changeBookingStatus=function(d){var e,f,g=!1,h=0;for(e=0;n>e;e++)g=g||a.bookings[e].isSelected,a.bookings[e].isSelected&&(h++,f=e);if(g)if(1==h){var i=!1;i=a.checkBookingStatusBeforeUpdate(a.bookings[f].status,d),i?(a.bookings[f].isSelected=!1,a.bookings[f].status=d,b.updateItem(a.bookings[f]).then(function(a){c.reload()},function(a){console.log("Item cannot be updated:"+a.message)})):window.alert(j.getMsg("bookingWrongStatus")+a.bookings[f].status+" на "+d)}else window.alert(j.getMsg("selectJustOneRow"));else window.alert(j.getMsg("selectTheRowToChange"))},a.hourStep=k.getCalendarSetting("hourStep"),a.minuteStep=k.getCalendarSetting("minuteStep"),a.format=k.getCalendarSetting("format"),a.dateOptions={showWeeks:k.getCalendarSetting("showWeeks"),startingDay:k.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("CheckoutDetailsCtrl",["$scope","checkoutFactory","$state","$interval","msgService","convertMMtoDDHHMM",function(a,b,c,d,e,f){a.showCheckouts=function(){var c;a.showInfo=!1,b.query(function(b){a.guestsToCheckout=b,c=a.guestsToCheckout.length,c>0&&(a.showInfo=!0),a.totalN=c,a.amountCheckout=0;for(var d=0;c>d;d++)a.amountCheckout=a.amountCheckout+a.guestsToCheckout[d].amount},function(b){a.message=e.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.convertMinutes=function(a){var b=f.convertMinutes(a);return b},d(function(){a.showCheckouts()},7e3)}]),angular.module("timeclubAngularApp").controller("DashboardCtrl",["$scope","guestFactory","guestCompute","clientFactoryFiltered","promotionFactory","$rootScope","msgService","serverTimeFactory",function(a,b,c,d,e,f,g,h){a.showInfo=!1,a.message=g.getMsg("loadingInProgress"),a.guestsModified=[];var i;h.getItem().then(function(b){i=b.data,a.startDateToday=new Date(i.currentDateTime),a.endDate=a.startDateToday,a.doDBFetch()},function(b){a.startDateToday=new Date,a.endDate=a.startDateToday,a.doDBFetch(),console.log("serverTimeFactory: "+g.getMsg("cannotQueryData"))}),a.doDBFetch=function(){a.startDate=c.computeStartDateThisDay(a.startDateToday,f.currentUserRole),a.startDate2=c.computeStartDateThisMonth(a.startDateToday),b.getItems().then(function(b){a.guests=b.data,a.showInfo=!0,e.getItems().then(function(b){a.promotions=b.data,a.guestsModified=c.modifyGuestArr(a.guests,a.promotions,a.endDate),a.outStatNow=c.computeGuestStat(a.guestsModified)},function(a){console.log("promotionFactory: "+g.getMsg("cannotQueryData"))})},function(b){a.message=response.status+" "+response.statusText,window.alert(g.getMsg("cannotQueryData")+a.message)}),d.getItems(a.startDate.toISOString(),a.endDate.toISOString()).then(function(b){a.clients=b.data,a.outStatToday=c.computeGuestStat(a.clients)},function(b){a.message=g.getMsg("cannotQueryData")+b.status+" "+b.statusText}),d.getItems(a.startDate2.toISOString(),a.endDate.toISOString()).then(function(b){a.clients2=b.data,a.outStatMonth=c.computeGuestStat(a.clients2)},function(b){a.message=g.getMsg("cannotQueryData")+b.status+" "+b.statusText})}}]),angular.module("timeclubAngularApp").controller("HistoryCtrl",["$scope","clientFactoryFiltered","guestCompute","promotionFactory","promoDetails","rowColorsGuests","$state","clientFactory","$rootScope","activePromotionFactory","msgService","textConsts","convertMMtoDDHHMM","guestFilterFactory","emplFactory","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.showClients=!1,a.message=k.getMsg("loadingInProgress");var q=l.getConstValueByName("companiesMaxNum");a.companies=[];for(var r=0;q>r;r++)a.companies[r]=r+1;var s;p.getItem().then(function(b){s=b.data,a.startDateToday=new Date(s.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=c.computeStartDateThisDay(a.startDateToday,i.currentUserRole),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(b){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=c.computeStartDateThisDay(a.startDateToday,i.currentUserRole),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+k.getMsg("cannotQueryData"))}),a.promotions=[],a.activePromotions=[],d.getItems().then(function(b){a.promotions=b.data},function(a){console.log("promotionFactory: "+k.getMsg("cannotQueryData"))}),j.getItems().then(function(b){a.activePromotions=b.data},function(a){console.log("activePromotionFactory: "+k.getMsg("cannotQueryData"))}),a.employees=[],o.getItems().then(function(b){a.employees=b.data},function(b){a.message=k.getMsg("cannotQueryData")+b.status+" "+b.statusText,window.alert("emplFactory: "+k.getMsg("cannotQueryData"))}),a.getPromoNameById=function(b){var c;return c=e.getNameById(b,a.promotions)},a.setRowBackgroud=function(a,b,c){var d;return d=f.setRowColor(a,b,c)},a.disableIsFreeED=!1,a.disablePromoSelectED=!0,a.changeIsFreeFlagByPromo=function(b,d,e){var f=!1,g=c.isSelectedPromoBirthday(b,a.promotions);return g?(a.disableIsFreeED=!0,a.disablePromoSelectED=!1,f=!0):(a.disableIsFreeED=!1,a.disablePromoSelectED=!0,f=!1),f},a.removePromoIfFree=function(a,b){var c;return c=a?null:b};var t;a.getDatesAndFetchClients=function(d,e){d>e?window.alert(k.getMsg("validateDatesBegEnd")):b.getItems(d.toISOString(),e.toISOString()).then(function(b){a.clients=b.data,t=a.clients.length,a.showClients=!0,a.search="",a.outStat=c.computeGuestStat(a.clients)},function(b){a.message=k.getMsg("cannotQueryData")+response.status+" "+response.statusText})},a.isCurrentUserAnAdminUser=i.isAdmin,a.showEditGuestModal=!1,a.showChangeButton=!0,a.backToMain=function(){if(i.isAdmin){var b,c,d,e=!1,f=0;for(b=0;t>b;b++)e=e||a.clients[b].isChecked,a.clients[b].isChecked&&(f++,c=b);e?1==f?(a.showChangeButton=!1,a.clients[c].isChecked=!1,d=window.confirm(k.getMsg("confirmBackToMain")),d?(a.clients[c].checkoutTime=null,a.clients[c].timeInClub=null,a.clients[c].amount=0,a.clients[c].isOpen=!0,h.updateItem(a.clients[c]).then(function(b){g.reload(),a.showChangeButton=!0},function(a){console.log("Item cannot be updated:"+a.message)})):a.cancelBackToMain()):window.alert(k.getMsg("selectJustOneRow")):window.alert(k.getMsg("selectTheRowToChange"))}else window.alert(k.getMsg("adminRoleNeeded"))},a.cancelBackToMain=function(){a.guestToBackToMain={},a.showChangeButton=!0},a.guestToEdit={},a.editGuests=function(){if(i.isAdmin){var b,d,e=!1,f=0;for(b=0;t>b;b++)e=e||a.clients[b].isChecked,a.clients[b].isChecked&&(f++,d=b);var g;e?1==f?(a.showChangeButton=!1,a.clients[d].isChecked=!1,a.guestToEdit=a.clients[d],g=c.isSelectedPromoBirthday(a.guestToEdit.promotion,a.promotions),g?(a.disablePromoSelectED=!1,a.disableIsFreeED=!0):(a.disablePromoSelectED=!0,a.disableIsFreeED=!1),a.showEditGuestModal=!0):window.alert(k.getMsg("selectJustOneRow")):window.alert(k.getMsg("selectTheRowToChange"))}else window.alert(k.getMsg("adminRoleNeeded"))},a.postChangesToGuest=function(){var b,c;p.getItem().then(function(d){b=d.data,c=new Date(b.currentDateTime),a.postChangesToGuestToDB(c)},function(b){c=new Date,a.postChangesToGuestToDB(c),console.log("serverTimeFactory: "+k.getMsg("cannotQueryData"))})},a.postChangesToGuestToDB=function(b){var d=Math.abs(Date.parse(b)-Date.parse(a.guestToEdit.checkoutTime)),e=!1,f=[];if(d<=i.oneDayInMSec&&(e=!0),e){a.guestToEdit=c.actualizateGuest(a.guestToEdit,a.promotions),f[0]=a.guestToEdit,f=c.modifyGuestArr(f,a.promotions,b);for(var j=0;j<f.length;j++)a.newClient={},a.newClient=f[0],h.updateItem(a.newClient).then(function(a){g.reload()},function(a){window.alert(k.getMsg("cannotUpdageRecord"))});a.showChangeButton=!0}else window.alert(k.getMsg("cannotChangeOldHisotory"))},a.cancelEditingGuest=function(){a.guestToEdit={},a.selectedPromoEdit={},a.showEditGuestModal=!1,a.showChangeButton=!0,g.reload()},a.changeEmplIsDir=function(b){return c.changeEmplIsDir(b,a.employees)},a.changeEmplName=function(b){return c.changeEmplName(b,a.employees)},a.convertMinutes=function(a){var b=m.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=n.searchGuestNameAndCompany(b,a.search)},a.computeSearchTotals=function(b){var c=[];return b.length>0&&(c=n.computeSearchTotals(b,a.clients)),c},a.hourStep=l.getCalendarSetting("hourStep"),a.minuteStep=l.getCalendarSetting("minuteStep"),a.format=l.getCalendarSetting("format"),a.dateOptions={showWeeks:l.getCalendarSetting("showWeeks"),startingDay:l.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("StatCtrl",["$scope","guestCompute","clientFactoryFiltered","promotionFactory","$rootScope","msgService","textConsts","serverTimeFactory",function(a,b,c,d,e,f,g,h){a.showInfo=!1,a.showMessage=!1,a.message=f.getMsg("loadingInProgress");var i,j,k,l,m,n,o;h.getItem().then(function(c){o=c.data,a.startDateToday=new Date(o.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(c){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+f.getMsg("cannotQueryData"))}),a.getDatesAndFetchClients=function(e,g){e>g?window.alert(f.getMsg("validateDatesBegEnd")):(a.showMessage=!0,d.getItems().then(function(d){a.promotions=d.data,c.getItems(a.startDate.toISOString(),a.endDate.toISOString()).then(function(c){a.clients=c.data,a.outStat=b.computeClientStat(a.clients,a.promotions),a.showMessage=!1,a.showInfo=!0;for(var d=0;d<a.outStat.length;d++)"------бесплатные"==a.outStat[d].category&&(i=a.outStat[d].n,l=a.outStat[d].sum),"--------стандарт (10 тг. минута)"==a.outStat[d].category&&(j=a.outStat[d].n,m=a.outStat[d].sum),"--------акции"==a.outStat[d].category&&(k=a.outStat[d].n,n=a.outStat[d].sum);a.chartGuestsOptions={data:[{freeGuests:i,paidGuests:j,promoGuests:k}],dimensions:{freeGuests:{name:"Бесплатные гости",type:"bar"},paidGuests:{name:"Платные гости",type:"bar"},promoGuests:{name:"По акции",type:"bar"}}},a.chartAmountsOptions={data:[{freeGuests:l,paidGuests:m,promoGuests:n}],dimensions:{freeGuests:{name:"Бесплатные гости",type:"bar"},paidGuests:{name:"Платные гости",type:"bar"},promoGuests:{name:"По акции",type:"bar"}}}},function(b){a.message=f.getMsg("cannotQueryData")+d.status+" "+d.statusText})},function(a){console.log("promotionFactory: "+f.getMsg("cannotQueryData"))}))},a.hourStep=g.getCalendarSetting("hourStep"),a.minuteStep=g.getCalendarSetting("minuteStep"),a.format=g.getCalendarSetting("format"),a.dateOptions={showWeeks:g.getCalendarSetting("showWeeks"),startingDay:g.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").controller("PreferencesCtrl",["$scope","promotionFactory","$state","staffFactory","$rootScope","msgService","textConsts","emplFactory","constFactory",function(a,b,c,d,e,f,g,h,i){a.showInfo=!1,a.showEmps=!1,a.showChngPwdModal=!1,a.defaultRoleForNewUsers=g.getDefaultRoleForNewUsers(),a.message=f.getMsg("cannotQueryData"),a.promotionTypes=g.getPromotionTypes(),a.consts=g.getConstArr(),a.showChangeButton=!0,a.currentUserName=e.currentUserName,a.currentUserId=e.currentUserId,h.getItems().then(function(b){a.employees=b.data,a.showEmps=!0},function(b){a.message=f.getMsg("cannotQueryData")+response.status+" "+response.statusText,window.alert("emplFactory: "+f.getMsg("cannotQueryData"))}),a.showPromos=!1,b.getItems().then(function(b){a.promotions=b.data,a.showPromos=!0},function(b){a.status="Unable to load promotions data: "+b.message}),a.showUsers=!1,d.getItems().then(function(b){a.staffs=b.data,a.showUsers=!0},function(a){window.alert("staffFactory: "+f.getMsg("cannotQueryData"))}),a.newPromotion={name:"",type:"",typeDesc:"",value:0},a.addPromotion=function(){if(e.isAdmin){a.newPromotion.isActive=!0;for(var c=0;c<a.promotionTypes.length;c++)a.promotionTypes[c].desc==a.newPromotion.typeDesc&&(a.newPromotion.type=a.promotionTypes[c].type);b.createItem(a.newPromotion).then(function(b){console.log("Item created"),a.promotions.push(a.newPromotion),a.showAddPromotionModal=!a.showAddPromotionModal},function(b){a.status="Unable to create promotion: "+b.message,console.log(a.status)})}else a.cancelAddingPromotion(),window.alert(f.getMsg("adminRoleNeeded"))},a.toggleAddPromotionModal=function(){a.showAddPromotionModal=!a.showAddPromotionModal},a.cancelAddingPromotion=function(){a.newPromotion={},a.showAddPromotionModal=!a.showAddPromotionModal},a.ToggleIsActiveFlagPromotion=function(){a.promoSelected=!1;var c;c=a.promotions.length;for(var d=0;c>d;d++)a.promoSelected=a.promoSelected||a.promotions[d].isSelected;if(a.promoSelected)if(e.isAdmin)for(d=0;c>d;d++)a.promotions[d].isSelected&&(a.promotions[d].isActive=!a.promotions[d].isActive,a.promotions[d].isSelected=!a.promotions[d].isSelected,b.updateItem(a.promotions[d]).then(function(a){console.log("Item updated")},function(a){console.log("Item cannot be updated:"+a.message)}));else window.alert(f.getMsg("adminRoleNeeded"));else window.alert(f.getMsg("selectTheRowToChange"))},a.roles=[{name:"user"},{name:"admin"}],a.register=function(){if(e.isAdmin){var b={username:this.email,email:this.email,password:this.password,role:this.role.name};this.password===this.passwordConf?d.createItem(b).then(function(b){a.showAddUserModal=!a.showAddUserModal,console.log("user created"),c.reload()},function(a){console.log(a),window.alert("authService: "+f.getMsg("cannotSaveRecord"))}):(this.passwordConf="",window.alert(f.getMsg("passwordIsNotConfirmed")))}else a.cancelAddingUser(),window.alert(f.getMsg("adminRoleNeeded"))},a.showAddEmployeeModal=!1,a.toggleAddEmployeeModal=function(){a.showAddEmployeeModal=!a.showAddEmployeeModal},a.cancelAddingEmployee=function(){a.newEmployee={},a.showAddEmployeeModal=!a.showAddEmployeeModal},a.newEmpl={},a.addNewEmpl=function(){e.isAdmin?h.createItem(a.newEmpl).then(function(b){console.log("Item created"),a.newEmpl={},a.showAddEmployeeModal=!a.showAddEmployeeModal,c.reload()},function(b){a.status="Unable to create employee: "+b.message,console.log(a.status)}):(a.cancelAddingEmployee(),window.alert(f.getMsg("adminRoleNeeded")))},a.deleteEmpl=function(){if(e.isAdmin){a.emplSelected=!1;var b,d;b=a.employees.length;for(var g=0;b>g;g++)a.emplSelected=a.emplSelected||a.employees[g].isSelected;if(a.emplSelected)if(1==window.confirm("Подтвердите удаление"))for(g=0;b>g;g++)a.employees[g].isSelected&&(d=a.employees[g].id,h.deleteItem(d).then(function(){c.reload()},function(){window.alert("emplFactory: "+f.getMsg("cannotDeleteRecord"))}));else for(g=0;b>g;g++)a.employees[g].isSelected=!1;else window.alert(f.getMsg("selectTheRowToDelete"))}else window.alert(f.getMsg("adminRoleNeeded"))},a.showAddUserModal=!1,a.toggleAddUserModal=function(){a.showAddUserModal=!a.showAddUserModal},a.cancelAddingUser=function(){a.newUser={},a.showAddUserModal=!a.showAddUserModal},a.DeleteUser=function(){if(e.isAdmin){a.userSelected=!1;var b,g;b=a.staffs.length;for(var h={},i=0;b>i;i++)a.userSelected=a.userSelected||a.staffs[i].isSelected;if(a.userSelected)if(1==window.confirm("Подтвердите удаление"))for(i=0;b>i;i++)a.staffs[i].isSelected&&(g=a.staffs[i].id,h=roleDetails.getRoleDetailsByUserId(g,a.roleMapping,a.roles),h.roleName==e.adminRoleName?window.alert(f.getMsg("cannotDeleteAdminUser")):d.deleteItem(g).then(function(){""!=h.roleMappingId||"undefined"!=h.roleMappingId?roleMappingFactory.remove({id:h.roleMappingId},function(){},function(){window.alert("roleMappingFactory: "+f.getMsg("cannotDeleteRecord"))}):c.reload(),c.reload()},function(){window.alert("staffFactory: "+f.getMsg("cannotDeleteRecord"))}));else for(i=0;b>i;i++)a.staffs[i].isSelected=!1;else window.alert(f.getMsg("selectTheRowToDelete"))}else window.alert(f.getMsg("adminRoleNeeded"))},a.ShowUserRole=function(b){return roleDetails.getRoleDetailsByUserId(b,a.roleMapping,a.roles).roleName},a.toggleChngPwdModal=function(){a.showChngPwdModal=!a.showChngPwdModal},a.this_user={id:a.currentUserId,password:""},a.new_password="",a.new_password2="",a.changePassword=function(){a.new_password==a.new_password2&&a.new_password.length>5?(a.this_user.password=a.new_password,d.updateItem(a.this_user).then(function(b){a.new_password="",a.new_password2="",a.showChngPwdModal=!1,window.alert("Пароль успешно изменен")},function(a){console.log("Item cannot be updated:"+a.message),window.alert("Ошибка сервера при изменении пароля")})):(window.alert("Введенные пароли не совпадают, либо длина нового пароля меньше 6 символов"),a.new_password="",a.new_password2="")},a.cancelChangePassword=function(){a.showChngPwdModal=!a.showChngPwdModal},i.getItems().then(function(b){a.constsDB=b.data},function(b){a.status="Unable to load constants data: "+b.message}),a.newConst={name:"",description:"",value:0},a.addConst=function(){e.isAdmin?i.createItem(a.newConst).then(function(b){console.log("Item created"),a.constsDB.push(a.newConst),a.showAddConstModal=!a.showAddConstModal},function(b){a.status="Unable to create const: "+b.message,console.log(a.status)}):(a.cancelAddingConst(),window.alert(f.getMsg("adminRoleNeeded")))},a.toggleAddConstModal=function(){a.showAddConstModal=!a.showAddConstModal},a.cancelAddingConst=function(){a.newConst={},a.showAddConstModal=!a.showAddConstModal},a.constToEdit={name:"",description:"",value:0},a.ToggleEditConstModal=function(){a.constSelected=!1;var b,c=0;b=a.constsDB.length;for(var d=0;b>d;d++)a.constSelected=a.constSelected||a.constsDB[d].isSelected,a.constsDB[d].isSelected&&(c+=1);if(1==c)if(e.isAdmin)for(d=0;b>d;d++)a.constsDB[d].isSelected&&(a.constsDB[d].isSelected=!a.constsDB[d].isSelected,a.constToEdit=a.constsDB[d],a.showEditConstModal=!a.showEditConstModal);else window.alert(f.getMsg("adminRoleNeeded"));else window.alert(f.getMsg("selectTheRowToChange"));
},a.editConstDB=function(){i.updateItem(a.constToEdit).then(function(b){console.log("Item updated"),a.showEditConstModal=!a.showEditConstModal},function(a){console.log("Item cannot be updated:"+a.message)})},a.cancelEditConst=function(){a.constToEdit={},a.showEditConstModal=!a.showEditConstModal}}]),angular.module("timeclubAngularApp").controller("HeaderCtrl",["$scope","$state","$location","localStorageService","$rootScope","AuthFactory",function(a,b,c,d,e,f){a.logout=function(){d.clearAll(),e.currentUserId=null,e.currentUserName=null,e.currentUserRole=null,e.isAdmin=null,e.isAuthenticated=null,f.logout().then(function(a){},function(a){}),c.path("/login")},a.stateReload=function(){b.reload()},a.isCurrentUserAnAdmin=e.isAdmin,a.isCollapsed=!0,a.collapse=function(){a.isCollapsed=!a.isCollapsed}}]),angular.module("timeclubAngularApp").controller("CheckoutCtrl",["$scope","checkoutService","clientFactory","guestCompute","promotionFactory","$state","$timeout","msgService","convertMMtoDDHHMM",function(a,b,c,d,e,f,g,h,i){var j,k;a.isPaidButtonActive=!1,e.getItems().then(function(c){a.promotions=c.data,a.guestsToCheckout=b.fetchArr(),k=b.fetchDateTime(),j=a.guestsToCheckout.length,a.totalN=j,a.guestsToCheckout=d.modifyGuestArr(a.guestsToCheckout,a.promotions,k),a.amountCheckout=0;for(var e=0;j>e;e++)a.amountCheckout=a.amountCheckout+a.guestsToCheckout[e].amount,a.guestsToCheckout[e].checkoutTime=k},function(a){console.log("promotionFactory: "+h.getMsg("cannotQueryData"))}),a.checkoutGuests=function(){for(var b=0;j>b;b++)a.guestsToCheckout[b].isActive=!1,a.guestsToCheckout[b].isChecked=!1,a.guestsToCheckout[b].isOpen=!1,c.updateItem(a.guestsToCheckout[b]).then(function(a){},function(a){console.log("Item cannot be updated:"+a.message)});a.isPaidButtonActive=!0},a.cancelCheckoutGuests=function(){f.go("app",{},{reload:!0})},a.closeCheckoutWindow=function(){f.go("app",{},{reload:!0})},a.convertMinutes=function(a){var b=i.convertMinutes(a);return b},a.defineBtnClass=function(a){var b="btn btn-default";return b=a?"btn btn-default":"btn btn-success"},a.defineBtnTxt=function(a){var b="Нет";return b=a?"Нет":"Да"}}]),angular.module("timeclubAngularApp").controller("ClientsCtrl",["$scope","clientListFactory","$state","$rootScope","msgService","textConsts",function(a,b,c,d,e,f){a.showInfo=!1,a.message=e.getMsg("loadingInProgress"),a.phoneMask=f.getPhoneMask();var g;b.getItems().then(function(b){a.clientlist=b.data,g=a.clientlist.length,a.showInfo=!0},function(b){a.message=e.getMsg("cannotQueryData")+response.status+" "+response.statusText}),a.newClient={},a.addClient=function(f,g){var h=!1;if(f.phone.match(/^\d+$/)&&10==f.phone.length&&(h=!0),h){var i=!0,j=new Date;b.findItemByPhone(f.phone).then(function(h){var k=h.data;1==k.result&&(i=!1),i?(g?f.sysComment="добавлено "+j+" пользователем "+d.currentUserName:f.sysComment="загружено из файла "+j+" пользователем "+d.currentUserName,b.createItem(f).then(function(){g&&(a.newClient={},c.reload())},function(){g?window.alert(e.getMsg("cannotSaveRecord")):console.log("clientListFactory: "+e.getMsg("cannotSaveRecord"))})):g?window.alert(e.getMsg("phoneNotUnique")):console.log("загрузка из excel файла: "+e.getMsg("phoneNotUnique"))},function(b){a.status="Unable to use find by phone service: "+b.message,console.log(a.status)})}else g?window.alert(e.getMsg("phoneWrongFormat")):console.log("загрузка из excel файла: "+e.getMsg("phoneWrongFormat"))},a.cancelAddingClient=function(){a.newClient={}},a.DeleteClient=function(f){if(d.isAdmin){for(var h,i=!1,j=0;g>j;j++)i=i||a.clientlist[j].isSelected;if(i)if(1==window.confirm("Подтвердите удаление"))for(j=0;g>j;j++)a.clientlist[j].isSelected&&(h=a.clientlist[j].id,b.deleteItem(h).then(function(){c.reload()},function(){window.alert(e.getMsg("cannotDeleteRecord"))}));else for(j=0;g>j;j++)a.clientlist[j].isSelected=!1;else window.alert(e.getMsg("selectTheRowToDelete"))}else window.alert(e.getMsg("adminRoleNeeded"))}}]),angular.module("timeclubAngularApp").constant("baseURL_flask","https://nekafesoft.com:443/api/").factory("AuthFactory",["$http","baseURL_flask",function(a,b){var c=b+"tokens",d={};return d.login=function(b,d){return a.defaults.headers.common.Authorization="Basic "+btoa(b+":"+d),a.post(c)},d.logout=function(){return a["delete"](c)},d}]).factory("serverTimeFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"time",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItem=function(){return a.get(d)},e}]).factory("guestFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"guests",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e}]).factory("clientFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"clients",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e.deleteItem=function(b){return a["delete"](d+"/"+b)},e}]).factory("clientFactoryFiltered",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"clients_filtered_by_checkout",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(b,c){return a.get(d+"/"+b+"/"+c)},e}]).factory("employeeWagesFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"employees",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(b,c){return a.get(d+"/"+b+"/"+c)},e}]).factory("clientListFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"clientlist",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e.deleteItem=function(b){return a["delete"](d+"/"+b)},e.findItemByPhone=function(c){return a.get(b+"client_by_phone/"+c)},e}]).factory("emplFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"employees",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e.deleteItem=function(b){return a["delete"](d+"/"+b)},e}]).factory("bookingFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"bookings",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e.deleteItem=function(b){return a["delete"](d+"/"+b)},e}]).factory("bookingFactoryToday",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"bookings_today",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e}]).factory("bookingFactoryTodayAndFuture",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"bookings_today_future",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e}]).factory("bookingFactoryLastYear",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"bookings_last_year",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e}]).factory("promotionFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"promotions",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e}]).factory("activePromotionFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"active_promotions",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e}]).service("guestCompute",["$rootScope","textConsts","constFactory","msgService",function(a,b,c,d){this.modifyGuestArr=function(a,b,e){var f=a,g=a.length,h=0,i=0,j=[];return c.getItems().then(function(a){if(j=a.data,0==j.length)return void window.alert(d.getMsg("basicConstsNotSet"));for(var c=0;c<j.length;c++)"pricePerMinute"==j[c].name?h=j[c].value:"maxAmount"==j[c].name&&(i=j[c].value);if(0==h)return void window.alert(d.getMsg("basicConstsNotSet_price"));if(0==i)return void window.alert(d.getMsg("basicConstsNotSet_max"));for(var c=0;g>c;c++){var k,l,m,n;if(k=1,null!=f[c].checkoutTime||void 0!=f[c].checkoutTime?f[c].timeInClub=Math.floor(Math.abs(Date.parse(f[c].arrivalTime)-Date.parse(f[c].checkoutTime))/6e4):f[c].timeInClub=Math.floor(Math.abs(Date.parse(f[c].arrivalTime)-Date.parse(e))/6e4),f[c].isFree||f[c].isEmployee)f[c].amount=0;else if(null!=f[c].promotion||void 0!=f[c].promotion){l=0;for(var o=!0;o;)b[l].id==f[c].promotion?(m=b[l].type,n=b[l].value,o=!1):(l++,l>=b.length&&(o=!1));"fixAmount"==m?f[c].amount=n:"fixDiscount"==m?(k=1-n/100,f[c].amount=Math.min(k*h*f[c].timeInClub,k*i)):f[c].amount=Math.min(h*f[c].timeInClub,i)}else f[c].amount=Math.min(h*f[c].timeInClub,i)}},function(a){$scope.status="Unable to load constants data: "+a.message}),f},this.computeGuestStat=function(a){for(var b=a,c=a.length,d=0,e=0,f=0,g=0,h=0,i=0;c>i;i++)b[i].isEmployee?g++:b[i].isFree?e++:d+=b[i].amount;var j=[];return h=c-g,f=h-e,j.push(c),j.push(g),j.push(h),j.push(f),j.push(e),j.push(d),j},this.computeClientStat=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=a.length,o=[],p=n,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0;for(d=0;d<b.length;d++)b[d].N=0,b[d].Sum=0;for(c=0;n>c;c++){var H=a[c].amount;if(q+=H,a[c].isEmployee)r++,s+=H,a[c].isEmployeeAtWork?(t++,u+=H):(v++,w+=H);else if(x++,y+=H,a[c].isFree)z++,A+=H;else if(B++,C+=H,null==a[c].promotion||void 0==a[c].promotion)D++,E+=H;else for(F++,G+=H,d=0;d<b.length;d++)b[d].id==a[c].promotion&&(b[d].N++,b[d].Sum=b[d].Sum+H)}for(0!=p&&(e=q/p),0!=r&&(f=s/r),0!=t&&(g=u/t),0!=v&&(h=w/v),0!=x&&(i=y/x),0!=z&&(j=A/z),0!=B&&(k=C/B),0!=D&&(l=E/D),0!=F&&(m=G/F),o.push({category:"Всего",n:p,sum:q,av:e}),o.push({category:"----Сотрудники",n:r,sum:s,av:f}),o.push({category:"------в смене",n:t,sum:u,av:g}),o.push({category:"------просто",n:v,sum:w,av:h}),o.push({category:"----Гости",n:x,sum:y,av:i}),o.push({category:"------бесплатные",n:z,sum:A,av:j}),o.push({category:"------платные",n:B,sum:C,av:k}),o.push({category:"--------стандарт (10 тг. минута)",n:D,sum:E,av:l}),o.push({category:"--------акции",n:F,sum:G,av:m}),d=0;d<b.length;d++)0!=b[d].N&&(b[d].av=b[d].Sum/b[d].N),o.push({category:"----------"+b[d].name,n:b[d].N,sum:b[d].Sum,av:b[d].av});return o},this.computeStartDateThisDay=function(c,d){var e,f,g,h,i,j;return d==a.adminRoleName?(e=b.getConstValueByName("startDayHH"),f=b.getConstValueByName("startDayMM"),g=0,i=c.getHours()<e?c-b.getOneDayInMSec():c):(h=b.getConstValueByName("usersSeeHistoryMin"),i=new Date(c-60*h*1e3),e=i.getHours(),f=i.getMinutes(),g=i.getSeconds()),j=new Date(i),j.setHours(e,f,g,0),j},this.computeStartDateThisMonth=function(a){var c,d,e=b.getConstValueByName("startDayHH"),f=b.getConstValueByName("startDayMM"),g=b.getConstValueByName("startDay");return c=a.getDate()<g||a.getDate()==g&&a.getHours()<e?a-10*b.getOneDayInMSec():a,d=new Date(c),d.setDate(g),d.setHours(e,f,0,0),d},this.isSelectedPromoBirthday=function(a,b){for(var c,d,e=!1,f=!0,g=0;f;)a==b[g].id?(c=b[g].type,d=b[g].value,f=!1):(g++,g>=b.length&&(f=!1));return e="fixAmount"==c&&0==d?!0:!1},this.actualizateGuest=function(a,b){var c=a,d=this.isSelectedPromoBirthday(c.promotion,b);return c.isEmployee?c.isFree=!0:(c.isDirector=!1,c.isEmployeeAtWork=!1),c.isEmployee&&c.isDirector&&(c.isEmployeeAtWork=!1),!c.isFree&&"Нет"!=c.promotion||d||(c.promotion=null),c.isActive=!0,c.isChecked=!1,c},this.isSelectedEmplDir=function(a,b){for(var c=!1,d=!0,e=0;d;)a==b[e].id?(c=b[e].isDirector,d=!1):(e++,e>=b.length&&(d=!1));return c},this.changeEmplIsDir=function(a,b){var c=!1,d=this.isSelectedEmplDir(a,b);return c=d?!0:!1},this.changeEmplName=function(a,b){for(var c,d=!0,e=0;d;)a==b[e].id?(c=b[e].name,d=!1):(e++,e>=b.length&&(d=!1));return c}}]).factory("staffFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"users",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e.deleteItem=function(b){return a["delete"](d+"/"+b)},e}]).service("userDetails",[function(){this.getUserNameByUserId=function(a,b){for(var c="",d=!0,e=0;d;)a==b[e].id?(c=b[e].email,d=!1):(e++,e>=b.length&&(d=!1));return c}}]).service("promoDetails",[function(){this.getNameById=function(a,b){var c;if(void 0!=a)for(var d=!0,e=0;d;)a==b[e].id?(c=b[e].name,d=!1):(e++,e>=b.length&&(d=!1));else c=void 0;return c}}]).service("rowColorsGuests",[function(){this.setRowColor=function(a,b,c){var d="default";return d=c?"success":a?"danger":void 0!=b&&null!=b&&"Нет"!=b?"info":"active"},this.setRowColorEmpl=function(a){var b="default";return b=a?"success":"danger"}}]).service("get_token_from_local_storage",["localStorageService",function(a){this.get_token=function(){if(a.isSupported)var b=a.get("token");return"Bearer "+b}}]).service("rowColorsBookings",[function(){this.setRowColor=function(a,b){var c="active";return a==b[1]?c="success":a==b[2]?c="info":a==b[3]&&(c="danger"),c}}]).service("convertMMtoDDHHMM",[function(){this.convertMinutes=function(a){var b,c,d,e,f,g,h,i=1440;return null==a||void 0==a?a=0:60>a?e=a.toString()+" м.":i>a?(c=Math.floor(a/60),g=c.toString(),d=a%60,h=d.toString(),e=g+" ч. "+h+" м."):a>=i&&(b=Math.floor(a/i),f=b.toString(),c=Math.floor((a-b*i)/60),g=c.toString(),d=(a-b*i)%60,h=d.toString(),e=f+" д. "+g+" ч. "+h+" м."),e}}]).service("checkoutService",[function(){var a,b=[];this.saveArr=function(c,d){b=c,a=d},this.fetchArr=function(){return b},this.fetchDateTime=function(){return a}}]).service("msgService",[function(){var a=[{name:"selectGuestToClose",text:"Нужно выбрать одного или нескольких гостей, которых вы хотите закрыть."},{name:"loadingInProgress",text:"Загрузка данных..."},{name:"cannotQueryData",text:"Не могу получить данные с сервера. "},{name:"doNotRemoveFrstRow",text:"Не нужно удалять первую строку. Просто нажмите Отменить, если не хотите добавлять группу."},{name:"needNamesForAllGuests",text:"Укажите имена для всех гостей."},{name:"selectJustOneRow",text:"Для изменения можно выбрать только одну запись."},{name:"selectTheRowToChange",text:"Выберите одну запись для изменения."},{name:"selectTheRowToDelete",text:"Выберите запись для удаления."},{name:"cannotUpdageRecord",text:"Не могу обновить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"cannotSaveRecord",text:"Не могу добавить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"cannotDeleteRecord",text:"Не могу удалить запись. Возможно проблемы на сервере или у вас нет соответствующего доступа. Попробуйте позже."},{name:"recordCreated",text:"Запись успешно создана"},{name:"needDateTimeBooking",text:"Укажите дату и время брони"},{name:"noBookingInPast",text:"Дата и время брони должны быть больше текущих"},{name:"bookingPhoneNotUnique",text:"Создание брони: клиент с таким номером уже есть в списке, не сохраняем"},{name:"bookingWrongStatus",text:"У брони нельзя или нет смысла менять статус: "},{name:"validateDatesBegEnd",text:"Дата окончания выборки должна быть больше даты начала"},{name:"adminRoleNeeded",text:"Данная операция доступна только для пользователей с расширенными правами. Если Вы уверены, что у вас есть такие права, попробуйте выйти и войти заново."},{name:"cannotChangeOldHisotory",text:"Изменить можно данные только по тем гостям, которые убыли в течение 24 часов; старые данные не подлежат изменению."},{name:"phoneNotUnique",text:"Номер телефона является уникальным, не должен повторяться. Клиент с таким номером телефона уже существует."},{name:"phoneWrongFormat",text:"Не могу добавить клиента. Некорректный формат телефона."},{name:"selectFile",text:"Сначала нужно выбрать файл"},{name:"clientsUploadCompleted",text:"Процедура загрузки клиентов из файла завершена. Были созданы все клиенты, кроме клиентов с повторящимимся и некорректными номерами."},{name:"passwordIsNotConfirmed",text:"Пароль и повторение пароля не совпадают."},{name:"cannotDeleteAdminUser",text:"Не могу удалить пользователя с расширенными правами"},{name:"cannotLogin",text:"Не могу войти. Проверьте логин и пароль."},{name:"cannotUpdateThisBooking",text:"Изменять можно только брони со статусом Новая"},{name:"confirmBackToMain",text:"Гость будет возвращён в Зал. Подтвердите."},{name:"basicConstsNotSet_price",text:"Не задана базовая константа - цена за минуту (pricePerMinute). Зайдите в Настройки под аминистратором и задайте константу!"},{name:"basicConstsNotSet_max",text:"Не задана базовая константа - максимальный чек (maxAmount). Зайдите в Настройки под аминистратором и задайте константу!"},{name:"basicConstsNotSet",text:"Не заданы базовые константы - Цена за минуту (pricePerMinute) и Максимальный чек (maxAmount). Зайдите в Настройки под аминистратором и задайте константы!"}];this.getMsg=function(b){for(var c="",d=!0,e=0;d;)a[e].name==b?(c=a[e].text,d=!1):(e++,e>=a.length&&(d=!1));return c}}]).service("guestFilterFactory",[function(){this.searchGuestNameAndCompany=function(a,b){var c,d=b.toUpperCase();if(""==d||null==d||void 0==d)c=!0;else{var e,f,g=a.name;if(""==g||null==g||void 0==g)e=!1;else{var h=g.toUpperCase();e=h.includes(d)}var i=a.companyN;if(""==i||null==i||void 0==i)f=!1;else{var j=i.toString(),k=j.toUpperCase();f=k==d?!0:!1}c=e||f}return c},this.computeSearchTotals=function(a,b){var c=[];c[0]=0,c[1]=0;for(var d=b.length,e=0;d>e;e++)this.searchGuestNameAndCompany(b[e],a)&&(c[0]++,c[1]=c[1]+b[e].amount);return c}}]).service("textConsts",[function(){const a=[{name:"hourStep",value:1},{name:"minuteStep",value:10},{name:"format",value:"dd.MM.yyyy"},{name:"showWeeks",value:!1},{name:"startingDay",value:1}],b="+7(999)999 99 99",c=["Новая","Пришли","Не пришли","Отмена"],d="user",e=[{type:"fixAmount",desc:"Фиксированная стоимость"},{type:"fixDiscount",desc:"Скидка"}],f="admin",g=864e5,h=[{name:"startDay",value:6,desc:"Первый день отчетного месяца"},{name:"startDayHH",value:10,desc:"Старт первого дня ЧАСЫ"},{name:"startDayMM",value:0,desc:"Старт первого дня МИНУТЫ"},{name:"usersSeeHistoryMin",value:30,desc:"Сколько минут истории видят пользователи"},{name:"adminWagePerHour",value:700,desc:"З/п админа за час, тг"},{name:"companiesMaxNum",value:50,desc:"Макс. кол-во компаний (зал, добавление гостя)"}];this.getCalendarSetting=function(b){for(var c,d=0;d<a.length;d++)a[d].name==b&&(c=a[d].value);return c},this.getPhoneMask=function(){return b},this.getBookingStatuses=function(){return c},this.getDefaultRoleForNewUsers=function(){return d},this.getPromotionTypes=function(){return e},this.getAdminRoleName=function(){return f},this.getOneDayInMSec=function(){return g},this.getConstArr=function(){return h},this.getConstValueByName=function(a){for(var b,c=!0,d=0;c;)a==h[d].name?(b=h[d].value,c=!1):(d++,d>=h.length&&(c=!1));return b}}]).factory("constFactory",["$http","baseURL_flask","get_token_from_local_storage",function(a,b,c){var d=b+"consts",e={};return a.defaults.headers.common.Authorization=c.get_token(),e.getItems=function(){return a.get(d)},e.getItem=function(b){return a.get(d+"/"+b)},e.createItem=function(b){return a.post(d,b)},e.updateItem=function(b){return a.put(d+"/"+b.id,b)},e}]),angular.module("timeclubAngularApp").controller("EmplWagesCtrl",["$scope","guestCompute","$state","msgService","textConsts","convertMMtoDDHHMM","employeeWagesFactory","rowColorsGuests","guestFilterFactory","serverTimeFactory",function(a,b,c,d,e,f,g,h,i,j){a.showClients=!1,a.message=d.getMsg("loadingInProgress");var k;const l=e.getConstValueByName("adminWagePerHour");var m;j.getItem().then(function(c){m=c.data,a.startDateToday=new Date(m.currentDateTime),a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate)},function(c){a.startDateToday=new Date,a.endDate=a.startDateToday,a.maxDate=a.startDateToday,a.startDate=b.computeStartDateThisMonth(a.startDateToday),a.getDatesAndFetchClients(a.startDate,a.endDate),console.log("serverTimeFactory: "+d.getMsg("cannotQueryData"))}),a.getDatesAndFetchClients=function(b,c){b>c?window.alert(d.getMsg("validateDatesBegEnd")):g.getItems(b.toISOString(),c.toISOString()).then(function(b){a.clients=b.data,k=a.clients.length,a.showClients=!0,a.search=""},function(b){a.message=d.getMsg("cannotQueryData")+b.status+" "+b.statusText})},a.setRowBackgroud=function(a){var b;return b=h.setRowColorEmpl(a)},a.convertMinutes=function(a){var b=f.convertMinutes(a);return b},a.search="",a.searchNameAndCompany=function(b){var c;return c=i.searchGuestNameAndCompany(b,a.search)},a.computeWage=function(a,b){var c;return c=b?Math.floor(a*l/60):0},a.hourStep=e.getCalendarSetting("hourStep"),a.minuteStep=e.getCalendarSetting("minuteStep"),a.format=e.getCalendarSetting("format"),a.dateOptions={showWeeks:e.getCalendarSetting("showWeeks"),startingDay:e.getCalendarSetting("startingDay")}}]),angular.module("timeclubAngularApp").run(["$templateCache",function(a){a.put("views/checkoutdetails.html",'<div class="container"> <div class="Modal-box"> <div class="row" ng-show="!showInfo"> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <img src="images/logo.14f67a6e.png" align="left"> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <h1 align="left">Добро пожаловать  в <strong>Некафе на Джандосова!</strong></h1> </div> <div class="row"> <h2 align="center">ул. Джандосова, 82</h2> <h2 align="center">+7 747 666 99 56</h2> <h2 align="center">nekafe.kz</h2> </div> </div> <div ng-show="showInfo"> <h4><strong>Спасибо за то, что были у нас в гостях!</strong></h4> <div class="table-wrapper"> <table class="table table-condensed"> <tr> <td><strong>Всего гостей:</strong></td> <td><strong>{{totalN}}</strong></td> <td><strong>Всего сумма:</strong></td> <td><strong>{{amountCheckout | number:0}}</strong></td> </tr> </table> </div> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th>Имя</th> <th>Время</th> <th align="center">Сумма</th> <th>Акция</th> <th>Время прихода</th> <th>Время ухода</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guestToCheckout.isFree,guestToCheckout.promotion,guestToCheckout.isEmployee)" ng-repeat="guestToCheckout in guestsToCheckout | orderBy:\'arrivalTime\':true track by guestToCheckout.id"> <td><strong>{{guestToCheckout.name}}</strong></td> <td>{{convertMinutes(guestToCheckout.timeInClub)}}</td> <td align="center"><strong>{{guestToCheckout.amount | number:0}}</strong></td> <td>{{getPromoNameById(guestToCheckout.promotion)}}</td> <td>{{guestToCheckout.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guestToCheckout.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> </tr> </tbody> </table> </div> </div> </div> </div>'),a.put("views/clients.html",'<div class="container-fluid"> <h4><strong>Добавить клиента</strong></h4> <!-- add client form BEGIN --> <form class="form-inline" role="form" id="AddClientForm" ng-submit="addClient(newClient,true)"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="newClient.phone" required> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="newClient.name"> <label for="birthday" class="control-label">День рождения</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="newClient.birthdate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="true" hidden-date="false" name="birthday" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newClient.comment"> <button type="submit" class="btn btn-success" id="confirmAddClientButton" ng-disabled="AddClientForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddClientButton" ng-click="cancelAddingClient()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> <!-- add client form END --> <!-- create clients from Excel file BEGIN --> <!--<h4><strong>Загрузить клиентов из Excel файла</strong></h4>\r\n        \r\n        <form class="form-inline">\r\n            <button class="btn btn-info" id="templateXLS" ng-click="downloadExampleXLS()">\r\n              <span class="glyphicon glyphicon-download" aria-hidden="true"></span> Скачать файл-образец</button>\r\n            <label class="btn btn-primary btn-file">\r\n              Выбрать файл... <input type="file" name="xlfile" id="xlf" style="display: none;">\r\n            </label>\r\n            <button class="btn btn-primary" id="upoadList" ng-click="uploadFromXLS()">\r\n              <span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Загрузить список из файла</button>\r\n        </form>--> <!-- create clients from Excel file END --> <br><br> <pre id="out"></pre> <h4><strong>Общий список клиентов</strong></h4> <!-- search client form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> <span>&nbsp;&nbsp;&nbsp;</span> <button class="btn btn-danger" id="deleteClient" ng-click="DeleteClient()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить</button> </form> <!-- search client form END --> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="table-wrapper"> <!-- list of clients BEGIN --> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Мобильный телефон</th> <th>Имя</th> <th>День рождения</th> <th>Комментарий</th> <th>Системный комментарий</th> </tr> </thead> <tbody> <!--<tr ng-repeat="client in clientlist | filter:search track by client.id" ng-show="showInfo">--> <tr dir-paginate="client in clientlist | filter:search |itemsPerPage:10 track by client.id" ng-show="showInfo"> <td><input type="checkbox" ng-model="client.isSelected"></td> <td>{{client.phone | phoneFilter}}</td> <td>{{client.name}}</td> <td>{{client.birthdate | date: \'dd.MM.y\' : \'+0600\'}}</td> <td>{{client.comment}}</td> <td>{{client.sysComment}}</td> </tr> </tbody> </table> <!-- pagination controls --> <dir-pagination-controls max-size="5" direction-links="true" boundary-links="true"> </dir-pagination-controls> <!-- list of clients END --> </div> </div>'),a.put("views/confirm.html",'<div class="container"> <div class="Modal-box"> <h3>Закрыть выбранных гостей?</h3> <div class="table-wrapper"> <table class="table table-condensed"> <tr> <td><h3>Всего гостей:</h3></td> <td><h3><strong>{{totalN}}</strong></h3></td> <td><h3>Всего сумма:</h3></td> <td><h3><strong>{{amountCheckout | number:0}}</strong></h3></td> </tr> </table> </div> <div class="table-wrapper"> <button class="btn btn-success" ng-click="checkoutGuests()" ng-disabled="isPaidButtonActive">Да</button> <button class="btn btn-danger" ng-click="cancelCheckoutGuests()" ng-disabled="isPaidButtonActive">Отмена</button> <button class="btn btn-info" ng-click="closeCheckoutWindow()" ng-disabled="!isPaidButtonActive">Оплачено</button> <table class="table table-condensed"> <thead> <tr> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th>Комментарий</th> <th>Статус оплаты</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guestToCheckout.isFree,guestToCheckout.promotion,guestToCheckout.isEmployee)" ng-repeat="guestToCheckout in guestsToCheckout | orderBy:\'arrivalTime\':true track by guestToCheckout.id"> <td><strong>{{guestToCheckout.name}}</strong></td> <td>{{guestToCheckout.companyN}}</td> <td align="center"><strong>{{guestToCheckout.amount | number:0}}</strong></td> <td>{{convertMinutes(guestToCheckout.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!guestToCheckout.isEmployee">Клиент</p><p ng-if="guestToCheckout.isEmployee && guestToCheckout.isEmployeeAtWork">Сотрудник Смена</p><p ng-if="guestToCheckout.isEmployee && !guestToCheckout.isEmployeeAtWork">Сотрудник Просто</p></td> <td><p ng-if="guestToCheckout.isFree">Бесплатно</p><p ng-if="!guestToCheckout.isFree">Платно</p></td> <td>{{getPromoNameById(guestToCheckout.promotion)}}</td> <td class="narrowColumn">{{guestToCheckout.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guestToCheckout.comment}}</td> <td><button ng-class="defineBtnClass(guestToCheckout.isChecked)" ng-click="guestToCheckout.isChecked=!guestToCheckout.isChecked">{{defineBtnTxt(guestToCheckout.isChecked)}}</button></td> </tr> </tbody> </table> </div> <button class="btn btn-success" ng-click="checkoutGuests()" ng-disabled="isPaidButtonActive">Да</button> <button class="btn btn-danger" ng-click="cancelCheckoutGuests()" ng-disabled="isPaidButtonActive">Отмена</button> <button class="btn btn-info" ng-click="closeCheckoutWindow()" ng-disabled="!isPaidButtonActive">Оплачено</button> </div> </div>'),a.put("views/dashboard.html",'<div class="container"> <div class="row row-content"> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive" ng-if="showInfo"> <thead> <tr> <th>Категория</th> <th align="right"><strong>Сумма</strong></th> <th>Всего людей</th> <th>Сотрудников</th> <th>Гостей</th> <th>Платных гостей</th> <th>Бесплатных гостей</th> </tr> </thead> <tbody> <tr> <td><strong>Сейчас в Некафе</strong> (в зале):</td> <td align="right"><strong>{{outStatNow[5] | number:0 }}</strong></td> <td>{{outStatNow[0]}}</td> <td>{{outStatNow[1]}}</td> <td>{{outStatNow[2]}}</td> <td>{{outStatNow[3]}}</td> <td>{{outStatNow[4]}}</td> </tr> <tr> <td><strong>Некафе за сегодня:</strong> начиная с <strong>{{startDate | date: \'dd.MM.y H:mm:ss\'}}</strong></td> <td align="right"><strong>{{outStatToday[5] | number:0 }}</strong></td> <td>{{outStatToday[0]}}</td> <td>{{outStatToday[1]}}</td> <td>{{outStatToday[2]}}</td> <td>{{outStatToday[3]}}</td> <td>{{outStatToday[4]}}</td> </tr> <tr> <td><strong>Некафе за этот месяц:</strong> начиная с <strong>{{startDate2 | date: \'dd.MM.y H:mm:ss\'}}</strong></td> <td align="right"><strong>{{outStatMonth[5] | number:0 }}</strong></td> <td>{{outStatMonth[0]}}</td> <td>{{outStatMonth[1]}}</td> <td>{{outStatMonth[2]}}</td> <td>{{outStatMonth[3]}}</td> <td>{{outStatMonth[4]}}</td> </tr> </tbody> </table> </div> </div> </div>'),a.put("views/emplwages.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <!-- set period form BEGIN--> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showClientsData" ng-click="getDatesAndFetchClients(startDate,endDate)">Показать</button> </div> </form> <!-- set period form END--> </div> <hr> <div class="row"> <div class="col-xs-12" ng-if="!showClients"><!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <h4><strong>Список сотрудников</strong></h4> <div class="row row-content"> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> <!-- search guest form END --> <br> <!-- list of guests BEGIN --> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th></th> <th>Имя</th> <th class="narrowColumn">Тип</th> <th class="narrowColumn">Время прихода</th> <th class="narrowColumn">Время ухода</th> <th align="center">Итого минут</th> <th align="center">Итого сумма, тг</th> <th>Время</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(client.isEmployeeAtWork)" ng-repeat="client in clients | filter:searchNameAndCompany | orderBy:\'checkoutTime\' track by client.id" ng-show="showClients"> <td><input type="checkbox" ng-model="client.isChecked"></td> <td><strong>{{client.name}}</strong></td> <td class="narrowColumn"><p ng-if="!client.isEmployee">Клиент</p><p ng-if="client.isEmployee && client.isEmployeeAtWork && !client.isDirector">Сотрудник Смена</p><p ng-if="client.isEmployee && !client.isEmployeeAtWork && !client.isDirector">Сотрудник Просто</p><p ng-if="client.isEmployee && client.isDirector">Директор</p></td> <td class="narrowColumn">{{client.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td class="narrowColumn">{{client.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td align="center">{{client.timeInClub}}</td> <td align="center">{{computeWage(client.timeInClub,client.isEmployeeAtWork) | number:0}}</td> <td>{{convertMinutes(client.timeInClub)}}</td> <td>{{client.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div>'),
a.put("views/footer.html",'<div class="footer"> <div class="container-fluid"> <div class="span4 offset4 text-center"> <p>Некафе на Джандосова - учет гостей</p> </div> </div> </div>'),a.put("views/header-login.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <p></p> </div> </div> </div>'),a.put("views/header.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container-fluid"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse" ng-click="collapse()"> <span class="sr-only">Навигация</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <!-- modify guest form END --> <a class="navbar-brand" ui-sref="app"><img src="images/logo.14f67a6e.png" height="30" width="30"></a> <button type="button" class="btn btn-info navbar-brand" id="ReloadButton" ng-click="stateReload()"> <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse" uib-collapse="isCollapsed"> <ul class="nav navbar-nav" ng-click="collapse()"> <li ui-sref-active-eq="active"><a ui-sref="app"><span class="glyphicon glyphicon-home" aria-hidden="true"></span> Зал</a></li> <li ui-sref-active-eq="active"><a ui-sref="app.reservations"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span> Брони</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.dashboard"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> Дашборд</a></li> <li ui-sref-active-eq="active"><a ui-sref="app.history"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> История</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.stat"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span> Статистика</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.emplwages"><span class="glyphicon glyphicon-usd" aria-hidden="true"></span> З/п админов</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.clients"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Клиенты</a></li> <li ui-sref-active-eq="active" ng-show="isCurrentUserAnAdmin"><a ui-sref="app.preferences"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Настройки</a></li> <!--<li ui-sref-active-eq="active"><a ui-sref="Modal.checkoutDetails"><span class="glyphicon glyphicon-film" aria-hidden="true"></span> Закрытие</a></li>--> </ul> <ul class="nav navbar-nav navbar-right"> <li><a id="LogoutButton" role="button" ng-click="logout()"> <span class="glyphicon glyphicon-log-out"></span> Выход</a> </li> </ul> </div> </div> </div> </div>'),a.put("views/history.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <!-- set period form BEGIN--> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showClientsData" ng-click="getDatesAndFetchClients(startDate,endDate)" ng-disabled="!isCurrentUserAnAdminUser">Показать</button> </div> </form> <!-- set period form END--> </div> <hr> <div class="row"> <div class="col-xs-12" ng-if="!showClients"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <!-- total BEGIN--> <h4><strong>Итого за период с {{startDate | date: \'dd.MM.y H:mm:ss\'}} по {{endDate | date: \'dd.MM.y H:mm:ss\'}}</strong></h4> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive" ng-if="showClients"> <tbody ng-if="showClients"> <tr> <td><strong>Сумма</strong></td> <td><strong>{{outStat[5] | number:0 }}</strong></td> <td>Всего людей</td> <td>{{outStat[0]}}</td> <td>Сотрудников</td> <td>{{outStat[1]}}</td> <td><strong>Гостей</strong></td> <td><strong>{{outStat[2]}}</strong></td> <td>Платных гостей</td> <td>{{outStat[3]}}</td> <td>Бесплатных гостей</td> <td>{{outStat[4]}}</td> </tr> </tbody> </table> </div> <!-- total END--> <hr> <h4><strong>Список гостей</strong></h4> <div class="row row-content"> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <button class="btn btn-info" id="editGuestButton" ng-show="showChangeButton" ng-disabled="!isCurrentUserAnAdminUser" ng-click="editGuests()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Изменить</button> <button class="btn btn-success" id="backToMainButton" ng-show="showChangeButton" ng-disabled="!isCurrentUserAnAdminUser" ng-click="backToMain()"> <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Вернуть в зал</button> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" align="right"> <!-- totals for searched items BEGIN--> <table> <tr> <td><strong>Гости:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[0]}}</strong></td> <td>&nbsp;&nbsp;&nbsp;</td> <td><strong>Сумма:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[1] | number:0}}</strong></td> </tr> </table> <!-- totals for searched items END--> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> </div> <!-- search guest form END --> <br> <div class="table-wrapper"> <!-- modify form BEGIN--> <table class="table table-condensed table-responsive" ng-show="showEditGuestModal"> <tr ng-class="setRowBackgroud(guestToEdit.isFree,guestToEdit.promotion,guestToEdit.isEmployee)"> <td> <form class="form-inline" role="form" id="EditGuestForm" ng-submit="postChangesToGuest()"> <label for="guestNameEdit" class="control-label" ng-show="!guestToEdit.isEmployee">Имя</label> <input type="text" id="guestNameEdit" class="form-control" placeholder="Имя гостя" ng-model="guestToEdit.name" ng-show="!guestToEdit.isEmployee" required> <label for="emplName" class="control-label" ng-show="guestToEdit.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="guestToEdit.isEmployee" ng-model="guestToEdit.emplID" ng-change="guestToEdit.isDirector=changeEmplIsDir(guestToEdit.emplID);guestToEdit.name=changeEmplName(guestToEdit.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isEmployee" ng-change="guestToEdit.isFree=guestToEdit.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isDirector" ng-show="guestToEdit.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="guestToEdit.isEmployeeAtWork" ng-show="guestToEdit.isEmployee" ng-disabled="guestToEdit.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!guestToEdit.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.companyN"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!guestToEdit.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.promotion" ng-disabled="guestToEdit.isFree && disablePromoSelectED" ng-change="guestToEdit.isFree=changeIsFreeFlagByPromo(guestToEdit.promotion,\'ED\',guestToEdit.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="guestToEdit.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="guestToEdit.isFree" ng-disabled="guestToEdit.isEmployee || disableIsFreeED" ng-change="guestToEdit.promotion=removePromoIfFree(guestToEdit.isFree,guestToEdit.promotion)"> Бесплатный</label> </div> <button type="submit" class="btn btn-success" id="confirmAddGuestButton" ng-disabled="EditGuestForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddGuestButton" ng-click="cancelEditingGuest()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> </td> </tr> </table> <!-- modify form END--> </div> <!-- list of guests BEGIN --> <div class="table-wrapper"> <table class="table table-condensed"> <thead> <tr> <th></th> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th class="narrowColumn">Время ухода</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(client.isFree,client.promotion,client.isEmployee)" ng-repeat="client in clients | filter: searchNameAndCompany | orderBy:\'checkoutTime\':true track by client.id" ng-show="showClients"> <td><input type="checkbox" ng-model="client.isChecked"></td> <td><strong>{{client.name}}</strong></td> <td>{{client.companyN}}</td> <td align="center"><strong>{{client.amount | number:0 }}</strong></td> <td>{{convertMinutes(client.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!client.isEmployee">Клиент</p><p ng-if="client.isEmployee && client.isEmployeeAtWork && !client.isDirector">Сотрудник Смена</p><p ng-if="client.isEmployee && !client.isEmployeeAtWork && !client.isDirector">Сотрудник Просто</p><p ng-if="client.isEmployee && client.isDirector">Директор</p></td> <td><p ng-if="client.isFree">Бесплатно</p><p ng-if="!client.isFree">Платно</p></td> <td>{{getPromoNameById(client.promotion)}}</td> <td class="narrowColumn">{{client.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td class="narrowColumn">{{client.checkoutTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{client.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div>'),a.put("views/login.html",'<div class="container-fluid"> <div class="row"> <div class="col-lg-5 col-md-4 col-sm-4 col-xs-12"></div> <div class="col-lg-2 col-md-4 col-sm-4 col-xs-12"> <h3>Некафе на Джандосова </h3> <form ng-submit="login()"> <div class="form-group"> <label class="sr-only" for="username">E-mail</label> <input type="text" class="form-control input-sm" id="username" placeholder="e-mail" ng-model="username"> </div> <div class="form-group"> <label class="sr-only" for="password">Пароль</label> <input type="password" class="form-control input-sm" id="password" placeholder="пароль" ng-model="password"> </div> <button type="submit" class="btn btn-info btn-sm">Вход</button> <button type="button" class="btn btn-default btn-sm" ng-click="cancelLogin()">Отмена</button> <br> <br> </form> </div> <div class="col-lg-5 col-md-4 col-sm-4 col-xs-12"></div> </div> </div>'),a.put("views/main.html",'<div class="row"> <div class="col-xs-12" ng-if="!showGuests"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> </div> <!-- total table BEGIN --> <div class="row"> <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12"><!-- fix at the top --> <!--<div class="container-fluid fixedTopPosition">--> <div class="container-fluid"> <div class="row"> <h4><strong>Сейчас в зале</strong></h4> <table class="table table-striped table-condensed table-responsive"> <tr> <td class="narrowColumn"><strong>Время</strong></td> <td class="narrowColumn"><strong>{{currentTimeToShow | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Сумма</strong></td> <td class="narrowColumn"><strong>{{outStatNow[5] | number:0}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Всего людей</strong></td> <td class="narrowColumn"><strong>{{outStatNow[0]}}</strong></td> </tr> <tr class="success"> <td class="narrowColumn"><strong>Сотрудников</strong></td> <td class="narrowColumn"><strong>{{outStatNow[1]}}</strong></td> </tr> <tr> <td class="narrowColumn"><strong>Всего гостей</strong></td> <td class="narrowColumn"><strong>{{outStatNow[2]}}</strong></td> </tr> <tr class="default"> <td class="narrowColumn">Платно</td> <td class="narrowColumn">{{outStatNow[3]}}</td> </tr> <tr class="danger"> <td class="narrowColumn">Бесплатно</td> <td class="narrowColumn">{{outStatNow[4]}}</td> </tr> <!--<option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}--> </table> </div> </div> </div> <!-- total table END --> <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12"> <div class="container-fluid"> <div class="row" ng-show="showAddGroupModule"> <!-- add guest / company BEGIN --> <h4><strong>Добавить гостя или компанию</strong></h4> <button type="button" class="btn btn-info" id="addGroupButton" ng-click="fillGroupInfo()" ng-disabled="showAddGroupTable"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-success" id="setGroup" ng-show="showAddGroupTable" ng-click="putGroupIntoDB()"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Готово</button> <button type="button" class="btn btn-danger" id="cancelSetGroup" ng-click="cancelFillGroupInfo()" ng-show="showAddGroupTable"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <br><br> <table class="table table-condensed table-responsive" id="addGroupTable" ng-show="showAddGroupTable"> <tr ng-repeat="newGuest in newGuests" ng-class="setRowBackgroud(newGuest.isFree,newGuest.promotion,newGuest.isEmployee)"> <td> <form class="form-inline" role="form"> <span>&nbsp;{{newGuest.guestIndex+1}}&nbsp;</span> <button type="button" class="btn btn-success" ng-click="addOneGuestToGroup()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" ng-click="removeOneGuestFromGroup(newGuest.guestIndex)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span></button> <label for="guestName" class="control-label" ng-show="!newGuest.isEmployee">Имя</label> <input type="text" id="guestName" class="form-control" placeholder="Имя гостя" ng-model="newGuest.name" ng-show="!newGuest.isEmployee" required> <label for="emplName" class="control-label" ng-show="newGuest.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="newGuest.isEmployee" ng-model="newGuest.emplID" ng-change="newGuest.isDirector=changeEmplIsDir(newGuest.emplID);newGuest.name=changeEmplName(newGuest.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <input type="checkbox" id="isOpen" ng-model="newGuest.isOpen" ng-checked="true" ng-show="false"> </div> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="newGuest.isEmployee" ng-change="newGuest.isFree=newGuest.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="newGuest.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="newGuest.isDirector" ng-show="newGuest.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="newGuest.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="newGuest.isEmployeeAtWork" ng-show="newGuest.isEmployee" ng-disabled="newGuest.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!newGuest.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!newGuest.isEmployee" ng-model="newGuest.companyN" ng-change="changeDefCompanyN(newGuest.companyN)"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!newGuest.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!newGuest.isEmployee" ng-model="newGuest.promotion" ng-disabled="newGuest.isFree && disablePromoSelectAD[newGuest.guestIndex]" ng-change="newGuest.isFree=changeIsFreeFlagByPromo(newGuest.promotion,\'AD\',newGuest.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newGuest.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="newGuest.isFree" ng-disabled="newGuest.isEmployee || disableIsFreeAD[newGuest.guestIndex]" ng-change="newGuest.promotion=removePromoIfFree(newGuest.isFree,newGuest.promotion)"> Бесплатный</label> </div> </form> </td> </tr> </table> </div> <!-- add guest / company END --> <div class="row row-content"> <h4><strong>Список гостей в зале</strong></h4> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12"> <button class="btn btn-info" id="editGuestButton" ng-show="showChangeButton" ng-click="editGuests()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Изменить</button> <button class="btn btn-warning" id="closeGuestButton" ng-show="showCloseButton" ng-click="showCheckoutModal()"> <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> Закрыть</button> </div> <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" align="right"> <!-- totals for searched items BEGIN--> <table> <tr> <td><strong>Гости:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[0]}}</strong></td> <td>&nbsp;&nbsp;&nbsp;</td> <td><strong>Сумма:&nbsp;</strong></td> <td><strong>{{computeSearchTotals(search)[1] | number:0}}</strong></td> </tr> </table> <!-- totals for searched items END--> <!-- search guest form BEGIN --> <form class="form-inline" role="form" id="searchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> </form> </div> <!-- search guest form END --> <br><br> </div> <div class="row"> <table class="table table-condensed table-responsive" ng-show="showEditGuestModal"> <!-- modify guest form BEGIN --> <tr ng-class="setRowBackgroud(guestToEdit.isFree,guestToEdit.promotion,guestToEdit.isEmployee)"> <td> <form class="form-inline" role="form" id="EditGuestForm" ng-submit="postChangesToGuest()"> <label for="guestNameEdit" class="control-label" ng-show="!guestToEdit.isEmployee">Имя</label> <input type="text" id="guestNameEdit" class="form-control" placeholder="Имя гостя" ng-model="guestToEdit.name" ng-show="!guestToEdit.isEmployee" required> <label for="emplName" class="control-label" ng-show="guestToEdit.isEmployee">Имя</label> <select class="form-control" id="emplName" ng-show="guestToEdit.isEmployee" ng-model="guestToEdit.emplID" ng-change="guestToEdit.isDirector=changeEmplIsDir(guestToEdit.emplID);guestToEdit.name=changeEmplName(guestToEdit.emplID)"> <option ng-repeat="employee in employees | orderBy:\'name\'" value="{{employee.id}}">{{employee.name}}</option> </select> <div class="checkbox"> <label><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isEmployee" ng-change="guestToEdit.isFree=guestToEdit.isEmployee"> Сотрудник</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee" ng-disabled="true"><input type="checkbox" id="isEmployee" ng-model="guestToEdit.isDirector" ng-show="guestToEdit.isEmployee" ng-disabled="true"> Директор</label> </div> <div class="checkbox"> <label ng-show="guestToEdit.isEmployee"><input type="checkbox" id="isEmployeeAtWork" ng-model="guestToEdit.isEmployeeAtWork" ng-show="guestToEdit.isEmployee" ng-disabled="guestToEdit.isDirector"> Смена?</label> </div> <label for="companyN" class="control-label" ng-show="!guestToEdit.isEmployee">№</label> <select class="form-control" id="companyN" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.companyN"> <option></option> <option ng-repeat="companyN in companies">{{companyN}}</option> </select> <label for="campaign" class="control-label" ng-show="!guestToEdit.isEmployee">Акция</label> <select class="form-control" id="campaign" ng-show="!guestToEdit.isEmployee" ng-model="guestToEdit.promotion" ng-disabled="guestToEdit.isFree && disablePromoSelectED" ng-change="guestToEdit.isFree=changeIsFreeFlagByPromo(guestToEdit.promotion,\'ED\',guestToEdit.guestIndex)"> <option>Нет</option> <option ng-repeat="promotion in promotions" value="{{promotion.id}}">{{promotion.name}}</option> </select> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="guestToEdit.comment"> <div class="checkbox"> <label><input type="checkbox" id="isFree" ng-model="guestToEdit.isFree" ng-disabled="guestToEdit.isEmployee || disableIsFreeED" ng-change="guestToEdit.promotion=removePromoIfFree(guestToEdit.isFree,guestToEdit.promotion)"> Бесплатный</label> </div> <button type="submit" class="btn btn-success" id="confirmAddGuestButton" ng-disabled="EditGuestForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span></button> <button type="button" class="btn btn-danger" id="cancelAddGuestButton" ng-click="cancelEditingGuest()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button> <br><br> </form> </td> </tr> </table> <!-- modify guest form END --> </div> <div class="table-wrapper"> <!-- list of guests BEGIN --> <table class="table table-condensed table-responsive"> <thead> <tr> <th></th> <th>Имя</th> <th>№</th> <th align="center">Сумма</th> <th>Время</th> <th class="narrowColumn">Тип</th> <th>Категория</th> <th>Акция</th> <th class="narrowColumn">Время прихода</th> <th>Комментарий</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(guest.isFree,guest.promotion,guest.isEmployee)" ng-repeat="guest in guests | filter:searchNameAndCompany | orderBy:\'arrivalTime\':true track by guest.id" ng-show="showGuests"> <td><input type="checkbox" ng-model="guest.isChecked"></td> <td><strong>{{guest.name}}</strong></td> <td>{{guest.companyN}}</td> <td align="center"><strong>{{guest.amount | number:0}}</strong></td> <td>{{convertMinutes(guest.timeInClub)}}</td> <td class="narrowColumn"><p ng-if="!guest.isEmployee">Клиент</p><p ng-if="guest.isEmployee && guest.isEmployeeAtWork && !guest.isDirector">Сотрудник Смена</p><p ng-if="guest.isEmployee && !guest.isEmployeeAtWork && !guest.isDirector">Сотрудник Просто</p><p ng-if="guest.isEmployee && guest.isDirector">Директор</p></td> <td><p ng-if="guest.isFree">Бесплатно</p><p ng-if="!guest.isFree">Платно</p></td> <td>{{getPromoNameById(guest.promotion)}}</td> <td class="narrowColumn">{{guest.arrivalTime | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{guest.comment}}</td> </tr> </tbody> </table> </div> <!-- list of guests END --> </div> </div> </div>'),a.put("views/modal.html",'<div class="Modal-backdrop"></div> <div class="Modal-holder" ui-view="modal" autoscroll="true"></div>'),a.put("views/preferences.html",'<div class="container"> <div class="row row-content"> <!-- change password BEGIN --> <h4><strong>Сменить пароль</strong></h4> <button class="btn btn-primary" id="chngPwdButton" ng-click="toggleChngPwdModal()"> Изменить пароль</button> <br><br> <modal title="Добавить пользователя" ng-show="showChngPwdModal"> <form ng-submit="changePassword()"> <p>Изменить пароль для пользователя <b>{{ currentUserName }}</b> </p> <div class="form-group"> <label class="sr-only" for="password">Новый пароль</label> <input type="password" class="form-control input-sm" id="password" placeholder="новый пароль" ng-model="new_password" required> </div> <div class="form-group"> <label class="sr-only" for="password">Повторите новый пароль</label> <input type="password" class="form-control input-sm" id="password" placeholder="новый пароль (повторно)" ng-model="new_password2" required> </div> <button type="submit" class="btn btn-primary">Изменить</button> <button type="button" class="btn btn-danger" ng-click="cancelChangePassword()">Отменить</button> <br> <br> </form> </modal> <!-- change password END --> </div> <div class="row row-content"> <h4><strong>Сотрудники</strong></h4> <!-- add employee form BEGIN --> <button class="btn btn-primary" id="addEmplButton" ng-click="toggleAddEmployeeModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить сотрудника</button> <button class="btn btn-danger" id="deleteEmpl" ng-click="deleteEmpl()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить сотрудника</button> <br> <div class="row row-content"> <br><br> <modal title="Добавить пользователя" ng-show="showAddEmployeeModal"> <form class="form-inline" role="form" id="AddEmplForm" ng-submit="addNewEmpl()"> <label for="emplName" class="control-label">Имя сотрудника</label> <input type="text" id="emplName" class="form-control" ng-model="newEmpl.name" required> <div class="checkbox"> <label><input type="checkbox" id="isDir" ng-model="newEmpl.isDirector"> Директор?</label> </div> <hr><br> <button type="submit" class="btn btn-primary" id="confirmAddEmplButton" ng-disabled="AddEmplForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddUserButton" ng-click="cancelAddingEmployee()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add employee form END --> <!-- list of employees BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Имя</th> <th>Директор?</th> </tr> </thead> <tbody> <tr ng-repeat="employee in employees | orderBy:\'name\' track by employee.id" ng-show="showEmps"> <td><input type="checkbox" ng-model="employee.isSelected"></td> <td>{{employee.name}}</td> <td><p ng-if="employee.isDirector">Да</p><p ng-if="!employee.isDirector">Нет</p></td> </tr> </tbody> </table> </div> <!-- list of employees END --> </div> <div class="row row-content"> <!-- add user form BEGIN --> <h4><strong>Пользователи системы</strong></h4> <button class="btn btn-primary" id="addUserButton" ng-click="toggleAddUserModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить пользователя</button> <button class="btn btn-danger" id="deleteUser" ng-click="DeleteUser()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Удалить пользователя</button> <div class="row row-content"> <modal title="Добавить пользователя" ng-show="showAddUserModal"> <form class="form-horizontal" role="form" id="AddUserForm" ng-submit="register()"> <hr> <label for="userEmail" class="control-label">E-mail</label> <input type="email" id="userEmail" class="form-control" placeholder="E-mail" ng-model="email" required> <label for="role" class="control-label">Роль</label> <select class="form-control" id="role" ng-model="role" ng-options="role.name for role in roles" required></select> <label for="userPassword" class="control-label">Пароль</label> <input type="password" id="userPassword" class="form-control" placeholder="пароль" ng-model="password" required> <label for="userPasswordConf" class="control-label">Повторите пароль</label> <input type="password" id="userPasswordConf" class="form-control" placeholder="повторите пароль" ng-model="passwordConf" required> <br> <button type="submit" class="btn btn-primary" id="confirmAddUserButton" ng-disabled="AddUserForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddUserButton" ng-click="cancelAddingUser()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add user form END --> <br> <!-- list of users BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>E-mail</th> <th>Роль</th> </tr> </thead> <tbody> <tr ng-repeat="staff in staffs | orderBy:\'email\' track by staff.id" ng-show="showUsers"> <td><input type="checkbox" ng-model="staff.isSelected"></td> <td>{{staff.email}}</td> <td>{{staff.role}}</td> </tr> </tbody> </table> </div> <!-- list of users END --> <h4><strong>Акции</strong></h4> <button class="btn btn-primary" id="addPromoButton" ng-click="toggleAddPromotionModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить акцию</button> <button class="btn btn-warning" id="activatePromo" ng-click="ToggleIsActiveFlagPromotion()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Активировать/Деактивировать</button> <!-- add promotion form BEGIN --> <div class="row row-content"> <modal title="Add promotion" ng-show="showAddPromotionModal"> <form class="form-horizontal" role="form" id="AddPromotionForm" ng-submit="addPromotion()"> <hr> <label for="promoName" class="control-label">Название</label> <input type="text" id="promoName" class="form-control" placeholder="Название акции" ng-model="newPromotion.name" required> <label for="promoType" class="control-label">Тип акции</label> <select class="form-control" id="promoType" ng-model="newPromotion.typeDesc" required> <option ng-repeat="promotionType in promotionTypes">{{promotionType.desc}}</option> </select> <label for="promoValue" class="control-label">Значение (тг. или %)</label> <input type="number" id="promoValue" class="form-control" placeholder="Значение (тг. если тип = фиксированная стоимость, % - если скидка)" ng-model="newPromotion.value" min="0" required> <br> <button type="submit" class="btn btn-primary" id="confirmAddPromoButton" ng-disabled="AddPromotionForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddPromoButton" ng-click="cancelAddingPromotion()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add promotion form END --> <br> <!-- list of promotions BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Активна?</th> <th>Название акции</th> <th>Тип</th> <th>Значение (тг. или %)</th> </tr> </thead> <tbody> <tr ng-repeat="promotion in promotions | orderBy:\'isActive\':true track by promotion.id" ng-show="showPromos"> <td><input type="checkbox" ng-model="promotion.isSelected"></td> <td><input type="checkbox" ng-model="promotion.isActive" disabled></td> <td>{{promotion.name}}</td> <td>{{promotion.typeDesc}}</td> <td>{{promotion.value}}</td> </tr> </tbody> </table> </div> <!-- list of promotions END --> <h4><strong>Значения констант из Базы данных</strong></h4> <p>Для корректной работы нужно задать две константы: Цена за минуту, тг (название = <b>pricePerMinute</b>) и Максимальный чек, тг (название = <b>maxAmount</b>). Если этих контстант нет в списке ниже, то их нужно добавить. Для этого нажмите кнопку <i>Добавить константу</i>. </p> <p> Также вы можете изменить значение этих констант в случае изменения ценовой политики заведения. Изменения цены коснутся всех гостей, которые находятся в зале, либо будут созданы после изменения констант. Для этого выделите нужную константу и нажмите кнопку <i>Изменить</i>. </p> <button class="btn btn-primary" id="addConstButton" ng-click="toggleAddConstModal()"> <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Добавить константу</button> <button class="btn btn-warning" id="editConst" ng-click="ToggleEditConstModal()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Изменить</button> <!-- add const form BEGIN --> <div class="row row-content"> <modal title="Add const" ng-show="showAddConstModal"> <form class="form-horizontal" role="form" id="AddConstForm" ng-submit="addConst()"> <hr> <label for="constName" class="control-label">Название</label> <input type="text" id="constName" class="form-control" placeholder="Название константы" ng-model="newConst.name" required> <label for="constValue" class="control-label">Значение</label> <input type="number" id="constValue" class="form-control" placeholder="Значение" ng-model="newConst.value" required> <label for="constDescription" class="control-label">Описание</label> <input type="text" id="constDescription" class="form-control" placeholder="Описание" ng-model="newConst.description"> <br> <button type="submit" class="btn btn-primary" id="confirmAddConstButton" ng-disabled="AddConstForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddConstButton" ng-click="cancelAddingConst()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- add const form END --> <!-- edit const form BEGIN --> <div class="row row-content"> <modal title="Edit const" ng-show="showEditConstModal"> <form class="form-horizontal" role="form" id="EditConstForm" ng-submit="editConstDB()"> <hr> <label for="editconstName" class="control-label">Название</label> <input type="text" id="editconstName" class="form-control" placeholder="Название константы" ng-model="constToEdit.name" required> <label for="editconstValue" class="control-label">Значение</label> <input type="number" id="editconstValue" class="form-control" placeholder="Значение" ng-model="constToEdit.value" required> <label for="editconstDescription" class="control-label">Описание</label> <input type="text" id="editconstDescription" class="form-control" placeholder="Описание" ng-model="constToEdit.description"> <br> <button type="submit" class="btn btn-primary" id="confirmAddConstButton" ng-disabled="EditConstForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Изменить</button> <button type="button" class="btn btn-danger" id="cancelAddConstButton" ng-click="cancelEditConst()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Отменить</button> <hr><br> </form> </modal> </div> <!-- edit const form END --> <br> <!-- list of consts from DB BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th></th> <th>Название</th> <th>Описание</th> <th>Значение</th> </tr> </thead> <tbody> <tr ng-repeat="constDB in constsDB | orderBy:\'name\' track by constDB.name"> <td><input type="checkbox" ng-model="constDB.isSelected"></td> <td>{{constDB.name}}</td> <td>{{constDB.description}}</td> <td>{{constDB.value}}</td> </tr> </tbody> </table> </div> <!-- list of consts END --> <h4><strong>Значения других констант - для информации</strong></h4> <!-- list of consts BEGIN --> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th>Название</th> <th>Описание</th> <th>Значение</th> </tr> </thead> <tbody> <tr ng-repeat="const in consts | orderBy:\'name\' track by const.name"> <td>{{const.name}}</td> <td>{{const.desc}}</td> <td>{{const.value}}</td> </tr> </tbody> </table> </div> <!-- list of consts END --> </div> </div>'),
a.put("views/reservations.html",'<div class="container-fluid"> <div class="col-xs-12" ng-if="!showInfo"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <!-- ADD new booking form BEGIN --> <div class="row" ng-show="showAddBookingForm"> <h4><strong>Добавить бронь</strong></h4> <form class="form-inline" role="form" id="AddBookingForm" ng-submit="addBooking(newBooking)"> <div class="form-group"> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="newBooking.name"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="newBooking.phone" required> <label for="dateSelect" class="control-label">Дата и время брони</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="newBooking.date" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="dateSelect" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false"> </datetimepicker> </div> <br><br> <div class="form-group"> <label for="numberofguests" class="control-label">Кол-во человек</label> <input type="number" min="1" id="numberofguests" class="form-control" ng-model="newBooking.numberOfPeople"> <div class="checkbox"> <label><input type="checkbox" ng-model="newBooking.isBirthday"> Есть именинник?</label> </div> <label for="place" class="control-label">Посадка</label> <input type="text" id="place" class="form-control" ng-model="newBooking.place"> <label for="payment" class="control-label">Сумма предоплаты</label> <input type="number" min="0" id="payment" class="form-control" ng-model="newBooking.prePayment"> </div> <br><br> <div class="form-group"> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="newBooking.comment"> </div> <br><br> <button type="submit" class="btn btn-success" id="confirmAddBookingButton" ng-disabled="AddBookingForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Добавить</button> <button type="button" class="btn btn-danger" id="cancelAddBookingButton" ng-click="cancelAddingBooking()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Отменить</button> </form> </div> <!-- add new booking form END --> <hr> <!-- modify booking form BEGIN --> <div class="row" ng-show="showEditBookingForm"> <h4><strong>Изменить бронь</strong></h4> <form class="form-inline" role="form" id="EditBookingForm" ng-submit="postChangesToBooking(modifiedBooking)"> <div class="form-group"> <label for="name" class="control-label">Имя</label> <input type="text" id="name" class="form-control" ng-model="modifiedBooking.name" ng-disabled="true"> <label for="phoneNum" class="control-label">Мобильный телефон</label> <input type="text" ui-mask="{{phoneMask}}" id="phoneNum" class="form-control" ng-model="modifiedBooking.phone" ng-disabled="true" required> <label for="dateSelect" class="control-label">Дата и время брони</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="modifiedBooking.date" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="dateSelect" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false"> </datetimepicker> </div> <br><br> <div class="form-group"> <label for="numberofguests" class="control-label">Кол-во человек</label> <input type="number" min="1" id="numberofguests" class="form-control" ng-model="modifiedBooking.numberOfPeople"> <div class="checkbox"> <label><input type="checkbox" ng-model="modifiedBooking.isBirthday"> Есть именинник?</label> </div> <label for="place" class="control-label">Посадка</label> <input type="text" id="place" class="form-control" ng-model="modifiedBooking.place"> <label for="payment" class="control-label">Сумма предоплаты</label> <input type="number" min="0" id="payment" class="form-control" ng-model="modifiedBooking.prePayment"> </div> <br><br> <div class="form-group"> <label for="comment" class="control-label">Комментарий</label> <input type="text" id="comment" class="form-control" ng-model="modifiedBooking.comment"> </div> <br><br> <button type="submit" class="btn btn-success" id="confirmModifyBookingButton" ng-disabled="EditBookingForm.$invalid"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Изменить</button> <button type="button" class="btn btn-danger" id="cancelModifyBookingButton" ng-click="cancelEditingBooking()"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Отменить</button> </form> </div> <!-- modify booking form END --> <h4><strong>Список броней</strong></h4> <!-- list of bookings - search form BEGIN --> <form class="form-inline" role="form" id="searchForm" ng-show="showSearchForm"> <input type="search" ng-model="search" class="form-control" placeholder="поиск..."> <button type="button" class="btn btn-default" ng-click="search = \'\'"> <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button> <span>&nbsp;&nbsp;&nbsp;</span> <button type="button" class="btn btn-default" ng-disabled="!TodayBookingsBtn" ng-click="showTodayBookings()">На сегодня</button> <button type="button" class="btn btn-default" ng-disabled="!TodayAndFutureBookingsBtn" ng-click="showTodayAndFutureBookings()">Сегодня и будущие</button> <button type="button" class="btn btn-default" ng-disabled="!AllBookingsBtn" ng-click="showAllBookings()">Все брони</button> <button type="button" class="btn btn-default" ng-disabled="!PastYearBookingsBtn" ng-click="showPastYearBookings()">Прошлогодние брони</button> </form> <br> <form class="form-inline" role="form" ng-show="showSearchForm"> <button type="button" class="btn btn-success" ng-click="changeBookingStatus(statuses[1])"> <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>Пришли</button> <button type="button" class="btn btn-warning" ng-click="changeBookingStatus(statuses[2])"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>Не пришли</button> <button type="button" class="btn btn-danger" ng-click="changeBookingStatus(statuses[3])"> <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>Отменить бронь</button> <button type="button" class="btn btn-info" ng-click="showModifyBookingForm()"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>Изменить бронь</button> </form> <!-- list of bookings - search form END --> <br> <!-- list of bookings BEGIN --> <div class="table-wrapper"> <table class="table table-condensed table-responsive"> <thead> <tr> <th></th> <th>Мобильный телефон</th> <th>Имя</th> <th class="narrowColumn">Дата брони</th> <th>Кол-во человек</th> <th>Посадка</th> <th>Именинник?</th> <th>Предоплата</th> <th>Комментарий</th> <th>Статус</th> </tr> </thead> <tbody> <tr ng-class="setRowBackgroud(booking.status)" ng-repeat="booking in bookings | orderBy:\'date\' | filter:search track by booking.id" ng-show="showInfo"> <td><input type="checkbox" ng-model="booking.isSelected"></td> <td>{{booking.phone | phoneFilter}}</td> <td>{{booking.name}}</td> <td class="narrowColumn">{{booking.date | date: \'dd.MM.y H:mm:ss\' : \'+0600\'}}</td> <td>{{booking.numberOfPeople}}</td> <td>{{booking.place}}</td> <td><p ng-if="booking.isBirthday">Да</p><p ng-if="!booking.isBirthday">Нет</p></td> <td>{{booking.prePayment | number:0}}</td> <td>{{booking.comment}}</td> <td>{{booking.status}}</td> </tr> </tbody> </table> </div> <!-- list of bookings END --> </div>'),a.put("views/stat.html",'<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12"></div> <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"> <div class="row" vertical-align="middle"> <form name="setPeriodForm"> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="beginDatetimepicker">Начало:</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="startDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="beginDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-5"> <label for="endDatetimepicker">Конец:&nbsp;&nbsp;</label> <datetimepicker hour-step="hourStep" minute-step="minuteStep" ng-model="endDate" show-meridian="false" date-format="{{format}}" date-options="dateOptions" datepicker-append-to-body="false" readonly-date="false" disabled-date="false" hidden-time="false" hidden-date="false" name="endDatetimepicker" show-spinners="false" readonly-time="false" date-opened="false" show-button-bar="false" max-date="maxDate"> </datetimepicker> </div> <div class="col-sm-12 col-xs-12 col-md-2"> <button class="btn btn-primary" id="showData" ng-click="getDatesAndFetchClients(startDate,endDate)">Показать статистику</button> </div> </form> </div> <hr> </div> <div class="container"> <div class="row" ng-if="showMessage"> <!-- show error message if no data is fetched from the server --> <h3>{{message}}</h3> </div> <div class="row" ng-show="showInfo"> <h4><strong>Статистика за период с {{startDate | date: \'dd.MM.y H:mm:ss\'}} по {{endDate | date: \'dd.MM.y H:mm:ss\'}}</strong></h4> <div class="table-wrapper"> <table class="table table-striped table-condensed table-responsive"> <thead> <tr> <th>Категория</th> <th>Кол-во</th> <th>Сумма</th> <th>Средний чек</th> </tr> </thead> <tbody> <tr ng-repeat="outStat in outStat"> <td>{{outStat.category}}</td> <td>{{outStat.n}}</td> <td>{{outStat.sum | number:0}}</td> <td>{{outStat.av | number:0}}</td> </tr> </tbody> </table> </div> </div> </div> <div class="container"> <div class="row" ng-show="showInfo"> <div> <h4><strong>Кол-во гостей</strong></h4> <angular-chart options="chartGuestsOptions"></angular-chart> </div> <div> <h4><strong>Суммы</strong></h4> <angular-chart options="chartAmountsOptions"></angular-chart> </div> </div> </div>')}]);